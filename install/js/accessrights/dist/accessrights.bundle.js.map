{"version":3,"file":"accessrights.bundle.js","sources":["../src/grid.js","../src/item/base.js","../src/item/title.js","../src/item/hint.js","../src/item/member.js","../src/item/role.js","../src/item/changer.js","../src/item/toggler.js","../src/item/controller.js","../src/item/variableselector.js","../src/item/usergrouptitle.js","../src/item/multivariable/footer.js","../src/item/multivariable/multiselector.js","../src/columnitem.js","../src/column.js","../src/section.js"],"sourcesContent":["import {BaseEvent, EventEmitter} from \"main.core.events\";\r\nimport {Dom, Reflection, Type, Tag, Loc, Text} from 'main.core';\r\nimport {Loader} from \"main.loader\";\r\nimport Section from \"./section\";\r\nimport 'ui.notification';\r\n\r\nconst BX = Reflection.namespace('BX');\r\n\r\ntype GridOptions = {\r\n\toptions: GridOptions;\r\n\trenderTo: HTMLElement;\r\n\tbuttonPanel: BX.UI.ButtonPanel;\r\n\tcomponent: string;\r\n\tactionSave: null;\r\n\tactionDelete: null;\r\n\tactionLoad: null;\r\n\tmode: 'string';\r\n\topenPopupEvent: null;\r\n\tpopupContainer: null;\r\n\tadditionalSaveParams: {};\r\n\tuserGroups: [];\r\n\taccessRights: [];\r\n\tloadParams: {};\r\n};\r\n\r\nexport default class Grid {\r\n\tstatic ACTION_SAVE = 'save';\r\n\tstatic ACTION_DELETE = 'delete';\r\n\tstatic ACTION_LOAD = 'load';\r\n\tstatic MODE = 'ajax';\r\n\r\n\tconstructor(options: GridOptions)\r\n\t{\r\n\t\toptions = options || {};\r\n\t\tthis.options = options;\r\n\t\tthis.renderTo = options.renderTo;\r\n\t\tthis.buttonPanel = BX.UI.ButtonPanel || null;\r\n\r\n\t\tthis.layout = {\r\n\t\t\tcontainer: null\r\n\t\t};\r\n\t\tthis.component = options.component ? options.component : null;\r\n\t\tthis.actionSave = options.actionSave || Grid.ACTION_SAVE;\r\n\t\tthis.actionDelete = options.actionDelete || Grid.ACTION_DELETE;\r\n\t\tthis.actionLoad = options.actionLoad || Grid.ACTION_LOAD;\r\n\t\tthis.mode = options.mode || Grid.MODE;\r\n\t\tthis.openPopupEvent = options.openPopupEvent ? options.openPopupEvent : null;\r\n\t\tthis.popupContainer = options.popupContainer ? options.popupContainer : null;\r\n\t\tthis.additionalSaveParams = options.additionalSaveParams ? options.additionalSaveParams : null;\r\n\t\tthis.signedParameters = options.signedParameters ? options.signedParameters : null;\r\n\t\tthis.loadParams = options.loadParams ? options.loadParams : null;\r\n\t\tthis.loader = null;\r\n\t\tthis.timer = null;\r\n\r\n\t\tthis.initData();\r\n\t\tif (options.userGroups)\r\n\t\t{\r\n\t\t\tthis.userGroups = options.userGroups;\r\n\t\t}\r\n\t\tif (options.accessRights)\r\n\t\t{\r\n\t\t\tthis.accessRights = options.accessRights;\r\n\t\t}\r\n\r\n\t\tthis.isRequested = false;\r\n\r\n\t\tthis.loadData();\r\n\t\tthis.bindEvents();\r\n\t}\r\n\r\n\tbindEvents(): void\r\n\t{\r\n\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights.ColumnItem:updateRole', this.updateRole.bind(this));\r\n\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights.ColumnItem:selectAccessItems', this.updateAccessVariationRight.bind(this));\r\n\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights.ColumnItem:accessOn', this.updateAccessRight.bind(this));\r\n\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights.ColumnItem:accessOff', this.updateAccessRight.bind(this));\r\n\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights.ColumnItem:update', this.adjustButtonPanel.bind(this));\r\n\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights.ColumnItem:addRole', this.addUserGroup.bind(this));\r\n\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights.ColumnItem:addRole', this.addRoleColumn.bind(this));\r\n\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights.ColumnItem:copyRole', this.addRoleColumn.bind(this));\r\n\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights.ColumnItem:copyRole', this.addUserGroup.bind(this));\r\n\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights.ColumnItem:removeRole', this.removeRoleColumn.bind(this));\r\n\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights.ColumnItem:removeRole', this.adjustButtonPanel.bind(this));\r\n\t\tEventEmitter.subscribe('BX.Main.SelectorV2:onGetEntityTypes', this.onGetEntityTypes.bind(this));\r\n\t}\r\n\r\n\tinitData(): void\r\n\t{\r\n\t\tthis.accessRights = [];\r\n\t\tthis.userGroups = [];\r\n\t\tthis.accessRightsSections = [];\r\n\t\tthis.headSection = null;\r\n\t\tthis.members = [];\r\n\t\tthis.columns = [];\r\n\t}\r\n\r\n\tfireEventReset(): void\r\n\t{\r\n\t\tEventEmitter.emit('BX.KosmosAccess.AccessRights:reset', this);\r\n\t}\r\n\r\n\tfireEventRefresh(): void\r\n\t{\r\n\t\tEventEmitter.emit( 'BX.KosmosAccess.AccessRights:refresh', this);\r\n\t}\r\n\r\n\tgetButtonPanel(): BX.UI.ButtonPanel\r\n\t{\r\n\t\treturn this.buttonPanel;\r\n\t}\r\n\r\n\tshowNotification(title): void\r\n\t{\r\n\t\tBX.UI.Notification.Center.notify({\r\n\t\t\tcontent: title,\r\n\t\t\tposition: 'top-right',\r\n\t\t\tautoHideDelay: 3000,\r\n\t\t});\r\n\t}\r\n\r\n\tsendActionRequest(): void\r\n\t{\r\n\t\tif (this.isRequested)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.isRequested = true;\r\n\t\tEventEmitter.emit(this, 'onBeforeSave', this);\r\n\r\n\t\tthis.timer = setTimeout(\r\n\t\t\t() => {\r\n\t\t\t\tthis.blockGrid();\r\n\t\t\t},\r\n\t\t\t1000\r\n\t\t);\r\n\r\n\t\tlet needReload = false;\r\n\t\tconst dataToSave = [];\r\n\t\tfor (let i = 0; i < this.userGroups.length; i++)\r\n\t\t{\r\n\t\t\tif (Text.toNumber(this.userGroups[i].id) === 0)\r\n\t\t\t{\r\n\t\t\t\tneedReload = true;\r\n\t\t\t}\r\n\r\n\t\t\tdataToSave.push({\r\n\t\t\t\taccessCodes: this.userGroups[i].accessCodes,\r\n\t\t\t\tid: this.userGroups[i].id,\r\n\t\t\t\ttitle: this.userGroups[i].title,\r\n\t\t\t\ttype: this.userGroups[i].type,\r\n\t\t\t\taccessRights: this.userGroups[i].accessRights\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tBX.ajax.runComponentAction(\r\n\t\t\tthis.component,\r\n\t\t\tthis.actionSave,\r\n\t\t\t{\r\n\t\t\t\tmode: this.mode,\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tuserGroups: dataToSave,\r\n\t\t\t\t\tparameters: this.additionalSaveParams\r\n\t\t\t\t},\r\n\t\t\t\tsignedParameters: this.signedParameters\r\n\t\t\t\t// analyticsLabel: {\r\n\t\t\t\t// \tviewMode: 'grid',\r\n\t\t\t\t// \tfilterState: 'closed'\r\n\t\t\t\t// }\r\n\t\t\t}\r\n\t\t).then(\r\n\t\t\t() => {\r\n\t\t\t\tif (needReload)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.reloadGrid();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.isRequested = false;\r\n\t\t\t\tthis.showNotification(Loc.getMessage('JS_UI_ACCESSRIGHTS_STTINGS_HAVE_BEEN_SAVED'));\r\n\t\t\t\tthis.unBlockGrid();\r\n\t\t\t\tthis.fireEventRefresh();\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.adjustButtonPanel()\r\n\t\t\t\t});\r\n\t\t\t\tclearTimeout(this.timer);\r\n\t\t\t\tconst waitContainer = this.buttonPanel.getContainer().querySelector('.ui-btn-wait');\r\n\t\t\t\tDom.removeClass(waitContainer, 'ui-btn-wait');\r\n\t\t\t},\r\n\t\t\t() => {\r\n\t\t\t\tthis.isRequested = false;\r\n\t\t\t\tthis.showNotification('Error message');\r\n\t\t\t\tthis.unBlockGrid();\r\n\t\t\t\tclearTimeout(this.timer);\r\n\t\t\t\tconst waitContainer = this.buttonPanel.getContainer().querySelector('.ui-btn-wait');\r\n\t\t\t\tDom.removeClass(waitContainer, 'ui-btn-wait');\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tEventEmitter.emit( 'BX.KosmosAccess.AccessRights:preservation', this);\r\n\t}\r\n\r\n\tlock(): void\r\n\t{\r\n\t\tDom.addClass(this.getMainContainer(), '--lock');\r\n\t}\r\n\r\n\tunlock(): void\r\n\t{\r\n\t\tDom.removeClass(this.getMainContainer(), '--lock');\r\n\t}\r\n\r\n\tdeleteActionRequest(roleId): void\r\n\t{\r\n\t\tif (this.isRequested)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.isRequested = true;\r\n\r\n\t\tthis.timer = setTimeout(\r\n\t\t\t() => {\r\n\t\t\t\tthis.blockGrid();\r\n\t\t\t},\r\n\t\t\t1000\r\n\t\t);\r\n\r\n\t\tBX.ajax.runComponentAction(\r\n\t\t\tthis.component,\r\n\t\t\tthis.actionDelete,\r\n\t\t\t{\r\n\t\t\t\tmode: this.mode,\r\n\t\t\t\tdata: {\r\n\t\t\t\t\troleId: roleId\r\n\t\t\t\t},\r\n\t\t\t\tsignedParameters: this.signedParameters\r\n\t\t\t\t// analyticsLabel: {\r\n\t\t\t\t// \tviewMode: 'grid',\r\n\t\t\t\t// \tfilterState: 'closed'\r\n\t\t\t\t// }\r\n\t\t\t}\r\n\t\t).then(\r\n\t\t\t() => {\r\n\t\t\t\tthis.isRequested = false;\r\n\t\t\t\tthis.showNotification(Loc.getMessage('JS_UI_ACCESSRIGHTS_ROLE_REMOVE'));\r\n\t\t\t\tthis.unBlockGrid();\r\n\t\t\t\tclearTimeout(this.timer);\r\n\t\t\t},\r\n\t\t\t() => {\r\n\t\t\t\tthis.isRequested = false;\r\n\t\t\t\tthis.showNotification('Error message');\r\n\t\t\t\tthis.unBlockGrid();\r\n\t\t\t\tclearTimeout(this.timer);\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\treloadGrid(): void\r\n\t{\r\n\t\tthis.initData();\r\n\r\n\t\tBX.ajax.runComponentAction(\r\n\t\t\tthis.component,\r\n\t\t\tthis.actionLoad,\r\n\t\t\t{\r\n\t\t\t\tmode: this.mode,\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tparameters: this.loadParams\r\n\t\t\t\t},\r\n\t\t\t\tsignedParameters: this.signedParameters\r\n\t\t\t}\r\n\t\t).then(\r\n\t\t\t(response) => {\r\n\t\t\t\tif (\r\n\t\t\t\t\tresponse.data['ACCESS_RIGHTS']\r\n\t\t\t\t\t&& response.data['USER_GROUPS']\r\n\t\t\t\t) {\r\n\t\t\t\t\tthis.accessRights = response.data.ACCESS_RIGHTS;\r\n\t\t\t\t\tthis.userGroups = response.data.USER_GROUPS;\r\n\t\t\t\t\tthis.loadData();\r\n\t\t\t\t\tthis.draw();\r\n\t\t\t\t}\r\n\t\t\t\tthis.unBlockGrid();\r\n\t\t\t},\r\n\t\t\t() => this.unBlockGrid\r\n\t\t);\r\n\t}\r\n\r\n\tblockGrid(): void\r\n\t{\r\n\t\tconst offsetTop =\r\n\t\t\tthis.layout.container.getBoundingClientRect().top < 0\r\n\t\t\t\t? '0'\r\n\t\t\t\t: this.layout.container.getBoundingClientRect().top\r\n\t\t;\r\n\r\n\t\tDom.addClass(this.layout.container, 'ui-access-rights-block');\r\n\t\tDom.style(this.layout.container, 'height', 'calc(100vh - ' + offsetTop  + 'px)')\r\n\r\n\t\tsetTimeout(() => {\r\n\t\t\tDom.style(this.layout.container, 'height', 'calc(100vh - ' + offsetTop  + 'px)')\r\n\t\t});\r\n\r\n\t\tthis\r\n\t\t\t.getLoader()\r\n\t\t\t.show()\r\n\t\t;\r\n\t}\r\n\r\n\tunBlockGrid(): void\r\n\t{\r\n\t\tDom.removeClass(this.layout.container, 'ui-access-rights-block');\r\n\t\tDom.style(this.layout.container, 'height', null)\r\n\r\n\t\tthis\r\n\t\t\t.getLoader()\r\n\t\t\t.hide()\r\n\t\t;\r\n\t}\r\n\r\n\tgetLoader(): Loader\r\n\t{\r\n\t\tif (!this.loader)\r\n\t\t{\r\n\t\t\tthis.loader = new Loader({\r\n\t\t\t\ttarget: this.layout.container\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn this.loader;\r\n\t}\r\n\r\n\tremoveRoleColumn(param): void\r\n\t{\r\n\t\tthis.headSection.removeColumn(param.data);\r\n\t\tthis.accessRightsSections.map(\r\n\t\t\t(data) => {\r\n\t\t\t\tdata.removeColumn(param.data);\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tconst targetIndex = this.userGroups.indexOf(param.data.userGroup);\r\n\t\tthis.userGroups.splice(targetIndex, 1);\r\n\r\n\t\tconst roleId = param.data.userGroup.id;\r\n\t\tif (roleId > 0)\r\n\t\t{\r\n\t\t\tthis.deleteActionRequest(roleId);\r\n\t\t}\r\n\t}\r\n\r\n\taddRoleColumn(event: BaseEvent): void\r\n\t{\r\n\t\tconst [param] = event.getData();\r\n\t\tif (!param)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst sections = this.accessRightsSections;\r\n\r\n\t\tfor (let i = 0; i < sections.length; i++)\r\n\t\t{\r\n\t\t\tparam.headSection = false;\r\n\t\t\tparam.newColumn = true;\r\n\t\t\tsections[i].addColumn(param);\r\n\t\t\tsections[i].scrollToRight(sections[i].getColumnsContainer().scrollWidth - sections[i].getColumnsContainer().offsetWidth, 'stop');\r\n\t\t}\r\n\r\n\t\tparam.headSection = true;\r\n\t\tparam.newColumn = true;\r\n\t\tthis.headSection.addColumn(param);\r\n\t}\r\n\r\n\taddUserGroup(event: BaseEvent): void\r\n\t{\r\n\t\tlet [options] = event.getData();\r\n\t\toptions = options || {};\r\n\t\tthis.userGroups.push(options);\r\n\t}\r\n\r\n\tupdateRole(event: BaseEvent): void\r\n\t{\r\n\t\tconst item = event.getData();\r\n\t\tconst index = this.userGroups.indexOf(item.userGroup);\r\n\t\tif (index >= 0)\r\n\t\t{\r\n\t\t\tthis.userGroups[index].title = item.text;\r\n\t\t}\r\n\t}\r\n\r\n\tadjustButtonPanel(): void\r\n\t{\r\n\t\tconst modifiedItems = this.getMainContainer().querySelectorAll('.ui-access-rights-column-item-changer-on');\r\n\t\tconst modifiedRoles = this.getMainContainer().querySelectorAll('.ui-access-rights-column-new');\r\n\t\tconst modifiedUsers = this.getMainContainer().querySelectorAll('.ui-access-rights-members-item-new');\r\n\t\tconst modifiedVariables = this.getMainContainer().querySelectorAll('.ui-tag-selector-container');\r\n\r\n\t\tif(modifiedItems.length > 0 || modifiedRoles.length > 0 || modifiedUsers.length > 0 || modifiedVariables.length > 0)\r\n\t\t{\r\n\t\t\tthis.buttonPanel.show();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.buttonPanel.hide();\r\n\t\t}\r\n\t}\r\n\r\n\tupdateAccessRight(event: BaseEvent): void\r\n\t{\r\n\t\tconst data = event.getData();\r\n\t\tconst userGroup = this.userGroups[this.userGroups.indexOf(data.userGroup)];\r\n\t\tconst accessId = data.access.id;\r\n\r\n\t\tfor (let i = 0; i < userGroup.accessRights.length; i++)\r\n\t\t{\r\n\t\t\tconst item = userGroup.accessRights[i];\r\n\t\t\tif (item && item.id === accessId)\r\n\t\t\t{\r\n\t\t\t\titem.value = (item.value === '0') ? '1' : '0';\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tuserGroup.accessRights.push({\r\n\t\t\tid: accessId,\r\n\t\t\tvalue: data.switcher.isChecked() ? '1' : '0'\r\n\t\t});\r\n\t}\r\n\r\n\tupdateAccessVariationRight(event: BaseEvent): void\r\n\t{\r\n\t\tconst item = event.getData();\r\n\t\tconst userGroup = this.userGroups[this.userGroups.indexOf(item.userGroup)];\r\n\t\tconst accessId = item.access.id;\r\n\r\n\t\tconst deleteIds = [];\r\n\t\tfor (let i = 0; i < userGroup.accessRights.length; i++)\r\n\t\t{\r\n\t\t\tconst item = userGroup.accessRights[i];\r\n\t\t\tif (item && item.id === accessId)\r\n\t\t\t{\r\n\t\t\t\tdeleteIds.push(i);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tdeleteIds.forEach((i) => {\r\n\t\t\tdelete (userGroup.accessRights[i]);\r\n\t\t});\r\n\t\tconst values = item.selectedValues || [];\r\n\t\tvalues.forEach((value) => {\r\n\t\t\tuserGroup.accessRights.push({\r\n\t\t\t\tid: accessId,\r\n\t\t\t\tvalue: value\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tloadData()\r\n\t{\r\n\t\tthis.accessRights.map(\r\n\t\t\t(data, index) => {\r\n\t\t\t\tdata.id = index;\r\n\t\t\t\tthis.accessRightsSections.push(this.addSection(data));\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\tgetColumns(): Column[]\r\n\t{\r\n\t\treturn this.columns;\r\n\t}\r\n\r\n\tgetSections(): Section[]\r\n\t{\r\n\t\treturn this.accessRightsSections;\r\n\t}\r\n\r\n\tgetUserGroups(): []\r\n\t{\r\n\t\tthis.userGroups.forEach(\r\n\t\t\t(item) => {\r\n\t\t\t\tif (item.accessCodes)\r\n\t\t\t\t{\r\n\t\t\t\t\tfor (const user in item.members)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\titem.accessCodes[user] = item.members[user].type\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\treturn this.userGroups;\r\n\t}\r\n\r\n\tgetHeadSection(): Section\r\n\t{\r\n\t\tif (!this.headSection)\r\n\t\t{\r\n\t\t\tthis.headSection = new Section({\r\n\t\t\t\theadSection: true,\r\n\t\t\t\tuserGroups: this.userGroups,\r\n\t\t\t\tgrid: this\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn this.headSection;\r\n\t}\r\n\r\n\taddSection(options): Section\r\n\t{\r\n\t\toptions = options || {};\r\n\t\treturn new Section({\r\n\t\t\tid: options.id,\r\n\t\t\thint: options.sectionHint,\r\n\t\t\ttitle: options.sectionTitle,\r\n\t\t\trights: options.rights ? options.rights : [],\r\n\t\t\tgrid: this\r\n\t\t});\r\n\t}\r\n\r\n\tgetSectionNode(): HTMLElement\r\n\t{\r\n\t\treturn Tag.render`<div class='ui-access-rights-section'></div>`;\r\n\t}\r\n\r\n\tgetMainContainer(): HTMLElement\r\n\t{\r\n\t\tif (!this.layout.container)\r\n\t\t{\r\n\t\t\tthis.layout.container = Tag.render`<div class='ui-access-rights'></div>`;\r\n\t\t}\r\n\r\n\t\treturn this.layout.container;\r\n\t}\r\n\r\n\tdraw(): void\r\n\t{\r\n\t\tconst docFragmentSections = document.createDocumentFragment();\r\n\t\tDom.append(this.getHeadSection().render(), docFragmentSections);\r\n\r\n\t\tthis\r\n\t\t\t.getSections()\r\n\t\t\t.map((data) => {\r\n\t\t\t\tDom.append(data.render(), docFragmentSections);\r\n\t\t\t})\r\n\t\t;\r\n\r\n\t\tthis.layout.container = null;\r\n\t\tDom.append(docFragmentSections, this.getMainContainer());\r\n\r\n\t\tthis.renderTo.innerHTML = '';\r\n\t\tDom.append(this.getMainContainer(), this.renderTo);\r\n\r\n\t\tthis.afterRender();\r\n\t}\r\n\r\n\tafterRender(): void\r\n\t{\r\n\t\tthis.getHeadSection().adjustEars();\r\n\t\tthis\r\n\t\t\t.getSections()\r\n\t\t\t.map((data) => {\r\n\t\t\t\tdata.adjustEars();\r\n\t\t\t})\r\n\t\t;\r\n\t}\r\n\r\n\tonMemberSelect(params): void\r\n\t{\r\n\t\tconst option = Grid.buildOption(params);\r\n\t\tif (!option)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (params.state === 'select')\r\n\t\t{\r\n\t\t\tEventEmitter.emit('BX.KosmosAccess.AccessRights:addToAccessCodes', option);\r\n\t\t}\r\n\t}\r\n\r\n\tonMemberUnselect(params)\r\n\t{\r\n\t\tconst option = Grid.buildOption(params);\r\n\r\n\t\tif (!option)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tEventEmitter.emit('BX.KosmosAccess.AccessRights:removeFromAccessCodes', option);\r\n\t}\r\n\r\n\tonGetEntityTypes(): void\r\n\t{\r\n\t\tconst controls = BX.Main\r\n\t\t\t.selectorManagerV2\r\n\t\t\t.controls\r\n\t\t;\r\n\t\tconst selectorInstance = controls[Object.keys(controls)[0]];\r\n\r\n\t\tselectorInstance.entityTypes.USERGROUPS = {\r\n\t\t\toptions: {\r\n\t\t\t\tenableSearch: 'Y',\r\n\t\t\t\tsearchById: 'Y',\r\n\t\t\t\taddTab: 'Y',\r\n\t\t\t\treturnItemUrl: (selectorInstance.getOption('returnItemUrl') === 'N' ? 'N' : 'Y')\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\tstatic buildOption(params): {}\r\n\t{\r\n\t\tconst controls = BX.Main\r\n\t\t\t.selectorManagerV2\r\n\t\t\t.controls\r\n\t\t;\r\n\t\tconst selectorInstance = controls[Object.keys(controls)[0]].selectorInstance;\r\n\t\tconst dataColumnAttribute = 'bx-data-column-id';\r\n\r\n\t\tconst node = selectorInstance.bindOptions.node;\r\n\r\n\t\tif (!node.hasAttribute(dataColumnAttribute) || Type.isUndefined(params.item))\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tconst columnId =  node.getAttribute(dataColumnAttribute);\r\n\r\n\t\tconst accessItem = params.item.id;\r\n\t\tconst entityType = params.entityType;\r\n\t\tconst accessCodesResult = {};\r\n\t\taccessCodesResult[accessItem] = entityType;\r\n\r\n\t\treturn {\r\n\t\t\taccessCodes: accessCodesResult,\r\n\t\t\tcolumnId: columnId,\r\n\t\t\titem: params.item\r\n\t\t};\r\n\t}\r\n}\r\n\r\nconst namespace = Reflection.namespace('BX.KosmosAccess');\r\nnamespace.AccessRights = Grid;\r\n","import ColumnItemOptions from \"../columnitem\";\r\nimport {Tag} from 'main.core';\r\n\r\nexport default class Base {\r\n\tconstructor(options: ColumnItemOptions)\r\n\t{\r\n\t\tthis.currentValue = options.currentValue || null;\r\n\t\tthis.identificator = 'col-' + Math.random();\r\n\t\tthis.parentContainer = options.container;\r\n\t\tthis.grid = options.grid;\r\n\t\tthis.text = options.text;\r\n\t\tthis.userGroup = options.userGroup;\r\n\t\tthis.access = options.access;\r\n\r\n\t\tthis.bindEvents();\r\n\t}\r\n\r\n\tbindEvents()\r\n\t{\r\n\t}\r\n\r\n\trender(): HTMLElement\r\n\t{\r\n\t\treturn Tag.render`<div></div>`;\r\n\t}\r\n\r\n\tgetId(): string\r\n\t{\r\n\t\treturn this.identificator;\r\n\t}\r\n}\r\n","import {Dom, Event, Text, Tag} from \"main.core\";\r\nimport {PopupWindowManager} from \"main.popup\";\r\nimport Base from \"./base\";\r\n\r\nexport default class Title extends Base\r\n{\r\n\tstatic TYPE = 'title';\r\n\r\n\trender(): HTMLElement\r\n\t{\r\n\t\tconst node = Tag.render`\r\n\t\t\t<div \r\n\t\t\t\tclass='ui-access-rights-column-item-text'\r\n\t\t\t\tdata-id='${this.getId()}'\r\n\t\t\t>\r\n\t\t\t\t${Text.encode(this.text)}\r\n\t\t\t</div>\r\n\t\t`;\r\n\r\n\t\tEvent.bind(node, 'mouseenter', this.adjustPopupHelper.bind(this));\r\n\r\n\t\tEvent.bind(node, 'mouseleave', () => {\r\n\t\t\tif (this.popupHelper)\r\n\t\t\t{\r\n\t\t\t\tthis.popupHelper.close();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn node;\r\n\t}\r\n\r\n\tadjustPopupHelper(): void\r\n\t{\r\n\t\tconst set = this.parentContainer.cloneNode(true);\r\n\r\n\t\tDom.style(set, 'position', 'absolute');\r\n\t\tDom.style(set, 'display', 'inline');\r\n\t\tDom.style(set, 'visibility', 'hidden');\r\n\t\tDom.style(set, 'height', '0');\r\n\r\n\t\tDom.append(set, document.body);\r\n\r\n\t\tsetTimeout(() => {\r\n\t\t\tDom.remove(set);\r\n\t\t});\r\n\r\n\t\tif (set.offsetWidth > this.parentContainer.offsetWidth)\r\n\t\t{\r\n\t\t\tDom.style(set, 'visibility', 'visible');\r\n\t\t\tthis.getPopupHelper().show();\r\n\t\t}\r\n\t}\r\n\r\n\tgetPopupHelper(): Popup\r\n\t{\r\n\t\tif (!this.popupHelper)\r\n\t\t{\r\n\t\t\tthis.popupHelper = PopupWindowManager.create(\r\n\t\t\t\tnull,\r\n\t\t\t\tthis.parentContainer,\r\n\t\t\t\t{\r\n\t\t\t\t\tautoHide: true,\r\n\t\t\t\t\tdarkMode: true,\r\n\t\t\t\t\tcontent: this.text,\r\n\t\t\t\t\tmaxWidth: this.parentContainer.offsetWidth,\r\n\t\t\t\t\toffsetTop: -9,\r\n\t\t\t\t\toffsetLeft: 5,\r\n\t\t\t\t\tanimation: 'fading-slide'\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn this.popupHelper;\r\n\t}\r\n}","import {Tag} from 'main.core';\r\nimport ColumnItemOptions from \"../columnitem\";\r\nimport Base from \"./base\";\r\n\r\nexport default class Hint extends Base\r\n{\r\n\tconstructor(options: ColumnItemOptions)\r\n\t{\r\n\t\tsuper(options);\r\n\r\n\t\tthis.hint = options.hint;\r\n\t\tthis.className = options.className;\r\n\r\n\t\tthis.hintNode = null;\r\n\t}\r\n\r\n\trender(): ?HTMLElement\r\n\t{\r\n\t\tif (!this.hintNode && this.hint)\r\n\t\t{\r\n\t\t\tconst hintManager = BX.UI.Hint.createInstance({\r\n\t\t\t\tid: 'access-rights-ui-hint-' + this.getId(),\r\n\t\t\t\tpopupParameters: {\r\n\t\t\t\t\tclassName: 'ui-access-rights-popup-pointer-events ui-hint-popup',\r\n\t\t\t\t\tautoHide: true,\r\n\t\t\t\t\tdarkMode: true,\r\n\t\t\t\t\tmaxWidth: 280,\r\n\t\t\t\t\toffsetTop: 0,\r\n\t\t\t\t\toffsetLeft: 8,\r\n\t\t\t\t\tangle: true,\r\n\t\t\t\t\tanimation: 'fading-slide',\r\n\t\t\t\t},\r\n\t\t\t});\r\n\r\n\t\t\tthis.hintNode = Tag.render`<span class='${this.className}'></span>`;\r\n\t\t\tthis.hintNode.setAttribute(hintManager.attributeName, this.hint);\r\n\t\t\tthis.hintNode.setAttribute(hintManager.attributeHtmlName, true);\r\n\t\t\tthis.hintNode.setAttribute(hintManager.attributeInteractivityName, true);\r\n\r\n\t\t\thintManager.initNode(this.hintNode);\r\n\t\t}\r\n\r\n\t\treturn this.hintNode;\r\n\t}\r\n}\r\n","import {Dom, Event, Text, Tag, Type, Loc, Reflection} from 'main.core';\r\nimport {BaseEvent, EventEmitter} from \"main.core.events\";\r\nimport {PopupWindowManager} from \"main.popup\";\r\nimport Base from \"./base\";\r\nimport ColumnItemOptions from \"../columnitem\";\r\n\r\nconst BX = Reflection.namespace('BX');\r\n\r\nexport default class Member extends Base\r\n{\r\n\tstatic TYPE = 'members';\r\n\r\n\tconstructor(options: ColumnItemOptions)\r\n\t{\r\n\t\tsuper(options);\r\n\r\n\t\tthis.openPopupEvent = options.openPopupEvent;\r\n\t\tthis.popupContainer = options.popupContainer\r\n\t\tthis.accessCodes = options.accessCodes || [];\r\n\t}\r\n\r\n\tbindEvents(): void\r\n\t{\r\n\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights:addToAccessCodes', this.addToAccessCodes.bind(this));\r\n\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights:removeFromAccessCodes', this.removeFromAccessCodes.bind(this));\r\n\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights:reset', this.resetNewMembers.bind(this));\r\n\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights:refresh', this.resetNewMembers.bind(this));\r\n\t}\r\n\r\n\tgetMember(): HTMLElement\r\n\t{\r\n\t\tif (!this.member)\r\n\t\t{\r\n\t\t\tconst members = this.userGroup.members || {};\r\n\t\t\tconst membersFragment = document.createDocumentFragment();\r\n\t\t\tlet counter = 0;\r\n\t\t\tthis.validateVariables();\r\n\r\n\t\t\tObject.keys(members).reverse().forEach(\r\n\t\t\t\t(item) => {\r\n\t\t\t\t\tcounter++;\r\n\t\t\t\t\tif (counter < 7)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst user = members[item];\r\n\r\n\t\t\t\t\t\tconst userNode = Tag.render`\r\n\t\t\t\t\t\t\t<div class='ui-access-rights-members-item'></div>\r\n\t\t\t\t\t\t`;\r\n\r\n\t\t\t\t\t\tif (user.new)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tDom.addClass(userNode, 'ui-access-rights-members-item-new');\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (user.avatar)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tconst userAvatar = Tag.render`<a class='ui-access-rights-members-item-avatar' title=\"${Text.encode(user.name)}\"></a>`;\r\n\t\t\t\t\t\t\tDom.style(userAvatar, 'backgroundImage', 'url(\\'' + encodeURI(user.avatar) + '\\')');\r\n\t\t\t\t\t\t\tDom.style(userAvatar, 'backgroundSize', 'cover');\r\n\t\t\t\t\t\t\tDom.append(userAvatar, userNode);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tlet avatarClass = 'ui-icon-common-user';\r\n\r\n\t\t\t\t\t\t\tif (user.type === 'groups')\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tavatarClass = 'ui-icon-common-user-group';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (user.type === 'sonetgroups')\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tavatarClass = 'ui-icon-common-company';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (user.type === 'usergroups')\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tavatarClass = 'ui-icon-common-user-group';\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tconst emptyAvatar = Tag.render`<a class='ui-icon ui-icon-xs' title=\"${Text.encode(user.name)}\"><i></i></a>`;\r\n\t\t\t\t\t\t\tDom.addClass(emptyAvatar, avatarClass);\r\n\t\t\t\t\t\t\tDom.append(emptyAvatar, userNode);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tDom.append(userNode, membersFragment);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t\tDom.append(this.getAddUserToRole(), membersFragment);\r\n\r\n\t\t\tthis.member = Tag.render`<div class='ui-access-rights-members'>${membersFragment}</div>`;\r\n\t\t\tEvent.bind(this.member, 'click', this.adjustPopupUserControl.bind(this));\r\n\t\t}\r\n\r\n\t\treturn this.member;\r\n\t}\r\n\r\n\trender(): HTMLElement\r\n\t{\r\n\t\treturn this.getMember();\r\n\t}\r\n\r\n\tresetNewMembers(): void\r\n\t{\r\n\t\tconst newMembers = this.getMember().querySelectorAll('.ui-access-rights-members-item-new');\r\n\r\n\t\tnewMembers.forEach((item) => {\r\n\t\t\tDom.removeClass(item, 'ui-access-rights-members-item-new');\r\n\t\t})\r\n\t}\r\n\r\n\tvalidateVariables(): void\r\n\t{\r\n\t\tif (Type.isUndefined(this.userGroup.accessCodes))\r\n\t\t{\r\n\t\t\tthis.userGroup.accessCodes = [];\r\n\t\t}\r\n\t}\r\n\r\n\tupdateMembers(): void\r\n\t{\r\n\t\tDom.remove(this.member);\r\n\t\tthis.member = null;\r\n\r\n\t\tDom.append(this.getMember(), this.parentContainer);\r\n\t\tthis.grid.getButtonPanel().show();\r\n\t}\r\n\r\n\taddToAccessCodes(event: BaseEvent): void\r\n\t{\r\n\t\tconst params = event.getData();\r\n\r\n\t\tif (params.columnId !== this.getId())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst firstKey = Object.keys(params.accessCodes)[0];\r\n\t\tconst type = params.accessCodes[firstKey].toUpperCase();\r\n\t\tthis.userGroup.accessCodes = Object.keys(this.accessCodes);\r\n\r\n\t\tconst item = params.item;\r\n\r\n\t\tif (!Type.isUndefined(item) && Object.keys(item).length)\r\n\t\t{\r\n\t\t\tthis.userGroup.members[firstKey] = {\r\n\t\t\t\tid: item.entityId,\r\n\t\t\t\tname: item.name,\r\n\t\t\t\tavatar: item.avatar,\r\n\t\t\t\turl: '',\r\n\t\t\t\tnew: true,\r\n\t\t\t\ttype: type.toLowerCase()\r\n\t\t\t};\r\n\r\n\t\t\tthis.updateMembers();\r\n\t\t}\r\n\r\n\t\tthis.userGroup.accessCodes = [];\r\n\r\n\t\tfor (const key in this.userGroup.members)\r\n\t\t{\r\n\t\t\tthis.userGroup.accessCodes[key] = this.userGroup.members[key].type;\r\n\t\t}\r\n\t}\r\n\r\n\tremoveFromAccessCodes(event): void\r\n\t{\r\n\t\tconst params = event.data;\r\n\r\n\t\tif (params.columnId !== this.identificator)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst firstKey = Object.keys(params.accessCodes)[0];\r\n\r\n\t\tdelete this.userGroup.members[firstKey];\r\n\t\tthis.updateMembers();\r\n\r\n\t\tthis.userGroup.accessCodes = [];\r\n\r\n\t\tfor (const key in this.userGroup.members)\r\n\t\t{\r\n\t\t\tthis.userGroup.accessCodes[key] = this.userGroup.members[key].type;\r\n\t\t}\r\n\t}\r\n\r\n\tadjustPopupUserControl(): void\r\n\t{\r\n\t\tconst users = [];\r\n\t\tconst groups = [];\r\n\t\tconst departments = [];\r\n\t\tconst sonetgroups = [];\r\n\r\n\t\tfor (const item in this.userGroup.members)\r\n\t\t{\r\n\t\t\tthis.userGroup.members[item].key = item;\r\n\r\n\t\t\tif (this.userGroup.members[item].type === 'users')\r\n\t\t\t{\r\n\t\t\t\tusers.push(this.userGroup.members[item]);\r\n\t\t\t}\r\n\t\t\telse if (this.userGroup.members[item].type === 'groups')\r\n\t\t\t{\r\n\t\t\t\tgroups.push(this.userGroup.members[item]);\r\n\t\t\t}\r\n\t\t\telse if (this.userGroup.members[item].type === 'usergroups')\r\n\t\t\t{\r\n\t\t\t\tgroups.push(this.userGroup.members[item]);\r\n\t\t\t}\r\n\t\t\telse if (this.userGroup.members[item].type === 'departments')\r\n\t\t\t{\r\n\t\t\t\tdepartments.push(this.userGroup.members[item]);\r\n\t\t\t}\r\n\t\t\telse if (this.userGroup.members[item].type === 'sonetgroups')\r\n\t\t\t{\r\n\t\t\t\tsonetgroups.push(this.userGroup.members[item]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst counterUsers = [];\r\n\r\n\t\tfor (const key in this.userGroup.members)\r\n\t\t{\r\n\t\t\tcounterUsers.push(this.userGroup.members[key])\r\n\t\t}\r\n\r\n\t\tif (counterUsers.length === 0)\r\n\t\t{\r\n\t\t\tthis.showUserSelectorPopup();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.getUserPopup(users, groups, departments, sonetgroups).show();\r\n\t}\r\n\r\n\tgetAddUserToRole(): HTMLElement\r\n\t{\r\n\t\tif (!this.addUserToRole)\r\n\t\t{\r\n\t\t\tthis.addUserToRole = Tag.render`\r\n\t\t\t\t<span \r\n\t\t\t\t\tclass='ui-access-rights-members-item ui-access-rights-members-item-add'\r\n\t\t\t\t\tbx-data-column-id='${this.getId()}'\r\n\t\t\t\t>\r\n\t\t\t\t</span>\r\n\t\t\t`;\r\n\t\t}\r\n\r\n\t\treturn this.addUserToRole;\r\n\t}\r\n\r\n\tgetUserPopup(users, groups, departments, sonetgroups): Popup\r\n\t{\r\n\t\tif (!this.popupUsers)\r\n\t\t{\r\n\t\t\tusers = users || [];\r\n\t\t\tgroups = groups || [];\r\n\t\t\tdepartments = departments || [];\r\n\t\t\tsonetgroups = sonetgroups || [];\r\n\r\n\t\t\tconst content = Tag.render`<div class='ui-access-rights-popup-toggler'></div>`;\r\n\r\n\t\t\tconst contentTitle = Tag.render`<div class='ui-access-rights-popup-toggler-title'></div>`;\r\n\r\n\t\t\tconst onTitleClick = (event: BaseEvent) => {\r\n\t\t\t\tconst node = event.target;\r\n\t\t\t\tactivate(node);\r\n\t\t\t\tadjustSlicker(node);\r\n\t\t\t};\r\n\r\n\t\t\tif (groups.length > 0)\r\n\t\t\t{\r\n\t\t\t\tconst groupTitleItem = Tag.render`\r\n\t\t\t\t\t<div \r\n\t\t\t\t\t\tclass='ui-access-rights-popup-toggler-title-item ui-access-rights-popup-toggler-title-item-active'\r\n\t\t\t\t\t\tdata-role='ui-access-rights-popup-toggler-content-groups'\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t${Loc.getMessage('JS_UI_ACCESSRIGHTS_USER_GROUPS')}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t`;\r\n\t\t\t\tEvent.bind(groupTitleItem, 'click', onTitleClick.bind(this));\r\n\r\n\t\t\t\tDom.append(groupTitleItem, contentTitle);\r\n\t\t\t}\r\n\r\n\t\t\tif (departments.length > 0)\r\n\t\t\t{\r\n\t\t\t\tconst groupTitleItem = Tag.render`\r\n\t\t\t\t\t<div \r\n\t\t\t\t\t\tclass='ui-access-rights-popup-toggler-title-item'\r\n\t\t\t\t\t\tdata-role='ui-access-rights-popup-toggler-content-departments'\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t${Loc.getMessage('JS_UI_ACCESSRIGHTS_DEPARTMENTS')}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t`;\r\n\t\t\t\tEvent.bind(groupTitleItem, 'click', onTitleClick.bind(this));\r\n\r\n\t\t\t\tDom.append(groupTitleItem, contentTitle);\r\n\t\t\t}\r\n\r\n\t\t\tif (users.length > 0)\r\n\t\t\t{\r\n\t\t\t\tconst groupTitleItem = Tag.render`\r\n\t\t\t\t\t<div \r\n\t\t\t\t\t\tclass='ui-access-rights-popup-toggler-title-item'\r\n\t\t\t\t\t\tdata-role='ui-access-rights-popup-toggler-content-users'\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t${Loc.getMessage('JS_UI_ACCESSRIGHTS_STAFF')}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t`;\r\n\t\t\t\tEvent.bind(groupTitleItem, 'click', onTitleClick.bind(this));\r\n\r\n\t\t\t\tDom.append(groupTitleItem, contentTitle);\r\n\t\t\t}\r\n\r\n\t\t\tif (sonetgroups.length > 0)\r\n\t\t\t{\r\n\t\t\t\tconst groupTitleItem = Tag.render`\r\n\t\t\t\t\t<div \r\n\t\t\t\t\t\tclass='ui-access-rights-popup-toggler-title-item'\r\n\t\t\t\t\t\tdata-role='ui-access-rights-popup-toggler-content-sonetgroups'\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t${Loc.getMessage('JS_UI_ACCESSRIGHTS_SOCNETGROUP')}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t`;\r\n\t\t\t\tEvent.bind(groupTitleItem, 'click', onTitleClick.bind(this));\r\n\r\n\t\t\t\tDom.append(groupTitleItem, contentTitle);\r\n\t\t\t}\r\n\r\n\t\t\tDom.append(Tag.render`<div class='ui-access-rights-popup-toggler-title-slicker'></div>`, contentTitle);\r\n\r\n\t\t\tDom.append(contentTitle, content);\r\n\r\n\t\t\tif (groups.length > 0)\r\n\t\t\t{\r\n\t\t\t\tDom.append(this.getUserPopupTogglerGroup(groups, 'groups'), content);\r\n\t\t\t}\r\n\r\n\t\t\tif (departments.length > 0)\r\n\t\t\t{\r\n\t\t\t\tDom.append(this.getUserPopupTogglerGroup(departments, 'departments'), content);\r\n\t\t\t}\r\n\r\n\t\t\tif (users.length > 0)\r\n\t\t\t{\r\n\t\t\t\tDom.append(this.getUserPopupTogglerGroup(users, 'users'), content);\r\n\t\t\t}\r\n\r\n\t\t\tif (sonetgroups.length > 0)\r\n\t\t\t{\r\n\t\t\t\tDom.append(this.getUserPopupTogglerGroup(sonetgroups, 'sonetgroups'), content);\r\n\t\t\t}\r\n\r\n\t\t\tconst footer = Tag.render`<div class='ui-access-rights-popup-toggler-footer'></div>`;\r\n\r\n\t\t\tconst footerLink = Tag.render`\r\n\t\t\t\t<div class='ui-access-rights-popup-toggler-footer-link'>\r\n\t\t\t\t\t${Loc.getMessage('JS_UI_ACCESSRIGHTS_ADD')}\r\n\t\t\t\t</div>\r\n\t\t\t`;\r\n\t\t\tEvent.bind(footerLink, 'click', (event: Event) => {\r\n\t\t\t\tthis.popupUsers.close();\r\n\t\t\t\tthis.showUserSelectorPopup();\r\n\t\t\t\tevent.preventDefault()\r\n\t\t\t});\r\n\r\n\t\t\tDom.append(footerLink, footer);\r\n\t\t\tDom.append(footer, content);\r\n\r\n\t\t\tconst adjustSlicker = (node) => {\r\n\t\t\t\tif (!Type.isDomNode(node))\r\n\t\t\t\t{\r\n\t\t\t\t\tnode = content.querySelector('.ui-access-rights-popup-toggler-title-item-active');\r\n\t\t\t\t}\r\n\t\t\t\tconst slicker = content.querySelector('.ui-access-rights-popup-toggler-title-slicker');\r\n\t\t\t\tDom.style(slicker, 'left', node.offsetLeft + 'px');\r\n\t\t\t\tDom.style(slicker, 'width', node.offsetWidth + 'px');\r\n\t\t\t};\r\n\r\n\t\t\tconst activate = (node) => {\r\n\t\t\t\tconst titles = content.querySelectorAll('.ui-access-rights-popup-toggler-title-item');\r\n\t\t\t\tconst contents = content.querySelectorAll('.ui-access-rights-popup-toggler-content');\r\n\r\n\t\t\t\tconst target = content.querySelector('.' + node.getAttribute('data-role'));\r\n\r\n\t\t\t\ttitles.forEach((item) => {\r\n\t\t\t\t\tDom.removeClass(item, 'ui-access-rights-popup-toggler-title-item-active');\r\n\t\t\t\t});\r\n\r\n\t\t\t\tcontents.forEach((item) => {\r\n\t\t\t\t\tDom.style(item, 'display', 'none');\r\n\t\t\t\t});\r\n\r\n\t\t\t\tDom.style(target, 'display', 'block');\r\n\t\t\t\tDom.addClass(node, 'ui-access-rights-popup-toggler-title-item-active');\r\n\t\t\t};\r\n\r\n\t\t\tthis.popupUsers = PopupWindowManager.create(\r\n\t\t\t\tnull,\r\n\t\t\t\tthis.getAddUserToRole(),\r\n\t\t\t\t{\r\n\t\t\t\t\tcontentPadding: 10,\r\n\t\t\t\t\tanimation: 'fading-slide',\r\n\t\t\t\t\tcontent,\r\n\t\t\t\t\tpadding: 0,\r\n\t\t\t\t\toffsetTop: 5,\r\n\t\t\t\t\tangle: {\r\n\t\t\t\t\t\tposition: 'top',\r\n\t\t\t\t\t\toffset: 35,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tautoHide: true,\r\n\t\t\t\t\tcloseEsc: true,\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tonPopupShow: () => {\r\n\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\tconst firstActiveNode = content.querySelector('.ui-access-rights-popup-toggler-title-item');\r\n\r\n\t\t\t\t\t\t\t\tif (!firstActiveNode)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tDom.addClass(firstActiveNode, 'ui-access-rights-popup-toggler-title-item-active');\r\n\t\t\t\t\t\t\t\tadjustSlicker(firstActiveNode);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tonPopupClose: () => {\r\n\t\t\t\t\t\t\tthis.popupUsers.destroy();\r\n\t\t\t\t\t\t\tthis.popupUsers = null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn this.popupUsers;\r\n\t}\r\n\r\n\tgetUserPopupTogglerGroup(array, type)\r\n\t{\r\n\t\tconst node = Tag.render`<div class='ui-access-rights-popup-toggler-content'></div>`;\r\n\t\tDom.addClass(node, 'ui-access-rights-popup-toggler-content-' + type);\r\n\r\n\t\tarray.forEach((item) => {\r\n\t\t\tconst toggler = Tag.render`<div class='ui-access-rights-popup-toggler-content-item'></div>`;\r\n\r\n\t\t\tif (item.avatar)\r\n\t\t\t{\r\n\t\t\t\tconst avatar = Tag.render`\r\n\t\t\t\t\t<a \r\n\t\t\t\t\t\tclass='ui-access-rights-popup-toggler-content-item-userpic'\r\n\t\t\t\t\t\ttitle=\"${Text.encode(item.name)}\"\r\n\t\t\t\t\t></a>\r\n\t\t\t\t`;\r\n\t\t\t\tDom.style(avatar, 'backgroundImage', 'url(\\'' + encodeURI(item.avatar) + '\\')');\r\n\t\t\t\tDom.style(avatar, 'backgroundSize', 'cover');\r\n\t\t\t\tDom.append(avatar, toggler);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tlet iconClass = '';\r\n\r\n\t\t\t\tif (type === 'users')\r\n\t\t\t\t{\r\n\t\t\t\t\ticonClass = 'ui-icon-common-user';\r\n\t\t\t\t}\r\n\t\t\t\telse if (type === 'groups')\r\n\t\t\t\t{\r\n\t\t\t\t\ticonClass = 'ui-icon-common-user-group';\r\n\t\t\t\t}\r\n\t\t\t\telse if (type === 'sonetgroups' || type === 'departments')\r\n\t\t\t\t{\r\n\t\t\t\t\ticonClass = 'ui-icon-common-company';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst emptyAvatar = Tag.render`<a class='ui-icon ui-icon-sm' title=\"${Text.encode(item.name)}\"><i></i></a>`;\r\n\t\t\t\tDom.addClass(emptyAvatar, iconClass);\r\n\t\t\t\tDom.style(emptyAvatar, 'margin', '5px 10px');\r\n\t\t\t\tDom.append(emptyAvatar, toggler);\r\n\t\t\t}\r\n\r\n\t\t\tDom.append(\r\n\t\t\t\tTag.render`<div class='ui-access-rights-popup-toggler-content-item-name'>${Text.encode(item.name)}</div>`,\r\n\t\t\t\ttoggler\r\n\t\t\t);\r\n\r\n\t\t\tconst removeButton = Tag.render`\r\n\t\t\t\t<div class='ui-access-rights-popup-toggler-content-item-remove'>${Loc.getMessage('JS_UI_ACCESSRIGHTS_REMOVE')}</div>\r\n\t\t\t`;\r\n\r\n\t\t\tEvent.bind(removeButton, 'click', () => {\r\n\t\t\t\tthis.userGroup.accessCodes.splice(this.userGroup.accessCodes.indexOf(item.key), 1);\r\n\r\n\t\t\t\tdelete this.userGroup.accessCodes[item.key];\r\n\t\t\t\tdelete this.userGroup.members[item.key];\r\n\r\n\t\t\t\tDom.remove(toggler);\r\n\r\n\t\t\t\tthis.updateMembers();\r\n\t\t\t\tthis.adjustPopupUserControl();\r\n\t\t\t\tthis.grid.getButtonPanel().show();\r\n\t\t\t});\r\n\r\n\t\t\tDom.append(removeButton, toggler);\r\n\r\n\t\t\tDom.append(toggler, node);\r\n\t\t});\r\n\r\n\t\treturn node;\r\n\t}\r\n\r\n\tshowUserSelectorPopup(): void\r\n\t{\r\n\t\tconst selectorInstance = BX.Main\r\n\t\t\t.selectorManagerV2.controls[this.popupContainer]\r\n\t\t\t?.selectorInstance\r\n\t\t;\r\n\r\n\t\tif (selectorInstance)\r\n\t\t{\r\n\t\t\tselectorInstance.itemsSelected = {};\r\n\t\t}\r\n\r\n\t\tBX.onCustomEvent(this.openPopupEvent, [{\r\n\t\t\tid: this.popupContainer,\r\n\t\t\tbindNode: this.getAddUserToRole()\r\n\t\t}]);\r\n\r\n\t\tBX.onCustomEvent('BX.Main.SelectorV2:reInitDialog', [{\r\n\t\t\tselectorId: this.popupContainer,\r\n\t\t\tselectedItems: this.userGroup.accessCodes\r\n\t\t}]);\r\n\t}\r\n}\r\n","import {EventEmitter} from \"main.core.events\";\r\nimport {Dom, Event, Text, Tag, Loc} from 'main.core';\r\nimport Base from \"./base\";\r\n\r\nimport {PopupWindowManager} from \"main.popup\";\r\nimport ColumnItemOptions from \"../columnitem\";\r\n\r\nexport default class Role extends Base\r\n{\r\n\tstatic TYPE = 'role';\r\n\r\n\tconstructor(options: ColumnItemOptions)\r\n\t{\r\n\t\tsuper(options);\r\n\r\n\t\tthis.column = options.column;\r\n\t}\r\n\r\n\tbindEvents(): void\r\n\t{\r\n\t\tEvent.bind(window, 'click', (event: Event) => {\r\n\t\t\tif (\r\n\t\t\t\tevent.target === this.getRole()\r\n\t\t\t\t|| event.target.closest('.ui-access-rights-role')\r\n\t\t\t)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.updateRole();\r\n\t\t\tthis.offRoleEditMode();\r\n\t\t});\r\n\r\n\t\tEventEmitter.subscribe(this.grid, 'onBeforeSave', () => {\r\n\t\t\tthis.updateRole();\r\n\t\t\tthis.offRoleEditMode();\r\n\t\t});\r\n\t}\r\n\r\n\tgetRole(): HTMLElement\r\n\t{\r\n\t\tif (this.role)\r\n\t\t{\r\n\t\t\treturn this.role;\r\n\t\t}\r\n\r\n\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights:preservation', this.updateRole.bind(this));\r\n\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights:preservation', this.offRoleEditMode.bind(this));\r\n\r\n\t\tthis.roleInput = Tag.render`\r\n\t\t\t\t<input\r\n\t\t\t\t\ttype='text'\r\n\t\t\t\t\tclass='ui-access-rights-role-input'\r\n\t\t\t\t\tvalue='${Text.encode(this.text)}'\r\n\t\t\t\t\tplaceholder='${Loc.getMessage('JS_UI_ACCESSRIGHTS_ROLE_NAME')}'\r\n\t\t\t\t/>\r\n\t\t\t`;\r\n\r\n\t\tEvent.bind(this.roleInput, 'keydown', (event: Event) => {\r\n\t\t\tif (event.keyCode === 13)\r\n\t\t\t{\r\n\t\t\t\tthis.updateRole();\r\n\t\t\t\tthis.offRoleEditMode();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tEvent.bind(this.roleInput, 'input', () => {\r\n\t\t\tthis.grid.getButtonPanel().show();\r\n\t\t});\r\n\r\n\t\tthis.roleValue = Tag.render`<div class='ui-access-rights-role-value'>${Text.encode(this.text)}</div>`;\r\n\r\n\t\tconst editControl = Tag.render`<div class='ui-access-rights-role-edit'></div>`;\r\n\t\tEvent.bind(editControl, 'click', this.onRoleEditMode.bind(this));\r\n\r\n\t\tconst removeControl = Tag.render`<div class='ui-access-rights-role-remove'></div>`;\r\n\t\tEvent.bind(removeControl, 'click', this.showPopupConfirm.bind(this));\r\n\r\n\t\tconst roleControlWrapper = Tag.render`\r\n\t\t\t\t<div class='ui-access-rights-role-controls'>\r\n\t\t\t\t\t${editControl}\r\n\t\t\t\t\t${removeControl}\r\n\t\t\t\t</div>\r\n\t\t\t`;\r\n\r\n\t\tthis.role = Tag.render`\r\n\t\t\t\t<div class='ui-access-rights-role'>\r\n\t\t\t\t\t${this.roleInput}\r\n\t\t\t\t\t${this.roleValue}\r\n\t\t\t\t\t${roleControlWrapper}\r\n\t\t\t\t</div>\r\n\t\t\t`;\r\n\r\n\t\treturn this.role;\r\n\t}\r\n\r\n\trender(): HTMLElement\r\n\t{\r\n\t\treturn this.getRole();\r\n\t}\r\n\r\n\tonRoleEditMode()\r\n\t{\r\n\t\tDom.addClass(this.getRole(), 'ui-access-rights-role-edit-mode');\r\n\t\tthis.roleInput.focus();\r\n\t}\r\n\r\n\tshowPopupConfirm()\r\n\t{\r\n\t\tif (!this.popupConfirm)\r\n\t\t{\r\n\t\t\t/**@ToDO check role*/\r\n\t\t\tthis.popupConfirm = PopupWindowManager.create(\r\n\t\t\t\tnull,\r\n\t\t\t\tthis.getRole(),\r\n\t\t\t\t{\r\n\t\t\t\t\twidth: 250,\r\n\t\t\t\t\toverlay: true,\r\n\t\t\t\t\tcontentPadding: 10,\r\n\t\t\t\t\tcontent: Loc.getMessage('JS_UI_ACCESSRIGHTS_POPUP_REMOVE_THIS_ROLE'),\r\n\t\t\t\t\tanimation: 'fading-slide'\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t\tthis.popupConfirm.setButtons([\r\n\t\t\t\tnew BX.UI.Button({\r\n\t\t\t\t\ttext: Loc.getMessage('JS_UI_ACCESSRIGHTS_POPUP_REMOVE'),\r\n\t\t\t\t\tclassName: 'ui-btn ui-btn-sm ui-btn-primary',\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tclick: () => {\r\n\t\t\t\t\t\t\tthis.popupConfirm.close();\r\n\t\t\t\t\t\t\tEventEmitter.emit('BX.KosmosAccess.AccessRights.ColumnItem:removeRole', this);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t\tnew BX.UI.Button({\r\n\t\t\t\t\ttext: Loc.getMessage('JS_UI_ACCESSRIGHTS_POPUP_CANCEL'),\r\n\t\t\t\t\tclassName: 'ui-btn ui-btn-sm ui-btn-link',\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tclick: () => {\r\n\t\t\t\t\t\t\tthis.popupConfirm.close();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t]);\r\n\t\t}\r\n\r\n\t\tthis.popupConfirm.show();\r\n\t}\r\n\r\n\tupdateRole(): void\r\n\t{\r\n\t\tif (this.roleValue.innerHTML === this.roleInput.value || this.roleInput.value === '')\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.text = this.roleInput.value;\r\n\t\tthis.userGroup = this.column.getUserGroup();\r\n\r\n\t\tthis.roleValue.innerText = this.roleInput.value;\r\n\t\tEventEmitter.emit('BX.KosmosAccess.AccessRights.ColumnItem:updateRole', this);\r\n\t}\r\n\r\n\toffRoleEditMode(): void\r\n\t{\r\n\t\tDom.removeClass(this.getRole(), 'ui-access-rights-role-edit-mode')\r\n\t}\r\n}\r\n","import {EventEmitter} from \"main.core.events\";\r\nimport {Dom, Tag} from \"main.core\";\r\nimport Base from \"./base\";\r\nimport ColumnItemOptions from \"../columnitem\";\r\n\r\nexport default class Changer extends Base\r\n{\r\n\tconstructor(options: ColumnItemOptions)\r\n\t{\r\n\t\tsuper(options);\r\n\r\n\t\tthis.isModify = false;\r\n\t}\r\n\r\n\tgetChanger(): HTMLElement\r\n\t{\r\n\t\tif (!this.changer)\r\n\t\t{\r\n\t\t\tthis.changer = Tag.render`<a class='ui-access-rights-column-item-changer'></a>`\r\n\t\t}\r\n\r\n\t\treturn this.changer;\r\n\t}\r\n\r\n\tbindEvents(): void\r\n\t{\r\n\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights:reset', this.offChanger.bind(this));\r\n\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights:refresh', this.refreshStatus.bind(this));\r\n\t}\r\n\r\n\trefreshStatus(): void\r\n\t{\r\n\t\tDom.removeClass(this.getChanger(), 'ui-access-rights-column-item-changer-on')\r\n\t}\r\n\r\n\toffChanger(): void\r\n\t{\r\n\t\tif (this.isModify)\r\n\t\t{\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis.refreshStatus();\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tadjustChanger(): void\r\n\t{\r\n\t\tthis.isModify = !this.isModify;\r\n\r\n\t\tDom.toggleClass(this.getChanger(), 'ui-access-rights-column-item-changer-on');\r\n\t}\r\n}\r\n","import ColumnItemOptions from \"../columnitem\";\r\nimport {EventEmitter} from \"main.core.events\";\r\nimport \"ui.switcher\";\r\nimport {Dom} from \"main.core\";\r\nimport Changer from \"./changer\";\r\n\r\nexport default class Toggler extends Changer\r\n{\r\n\tstatic TYPE = 'toggler';\r\n\r\n\tconstructor(options: ColumnItemOptions)\r\n\t{\r\n\t\tsuper(options);\r\n\r\n\t\tthis.switcher = new BX.UI.Switcher(\r\n\t\t\t{\r\n\t\t\t\tsize: 'small',\r\n\t\t\t\tchecked: this.currentValue === '1',\r\n\t\t\t\thandlers: {\r\n\t\t\t\t\tchecked: () => {\r\n\t\t\t\t\t\tEventEmitter.emit('BX.KosmosAccess.AccessRights.ColumnItem:accessOn', this);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tunchecked: () => {\r\n\t\t\t\t\t\tEventEmitter.emit('BX.KosmosAccess.AccessRights.ColumnItem:accessOff', this);\r\n\t\t\t\t\t},\r\n\t\t\t\t\ttoggled: () => {\r\n\t\t\t\t\t\tthis.adjustChanger();\r\n\t\t\t\t\t\tEventEmitter.emit('BX.KosmosAccess.AccessRights.ColumnItem:update', this);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\toffChanger(): void\r\n\t{\r\n\t\tif (this.isModify)\r\n\t\t{\r\n\t\t\tthis.switcher.check(!this.switcher.isChecked());\r\n\t\t}\r\n\r\n\t\tsuper.offChanger();\r\n\t}\r\n\r\n\trender(): HTMLElement\r\n\t{\r\n\t\tDom.append(this.switcher.getNode(), this.getChanger());\r\n\r\n\t\treturn this.getChanger();\r\n\t}\r\n}\r\n","import {EventEmitter} from \"main.core.events\";\r\nimport {Event, Text, Tag, Loc, Dom} from 'main.core';\r\nimport Base from \"./base\";\r\n\r\nimport { Menu} from \"main.popup\";\r\nimport Role from \"./role\";\r\n\r\nexport default class Controller extends Base\r\n{\r\n\trender(): HTMLElement\r\n\t{\r\n\t\tif (!this.controller)\r\n\t\t{\r\n\t\t\tthis.controllerLink = Tag.render`\r\n\t\t\t\t<div class='ui-access-rights-column-item-controller-link'>\r\n\t\t\t\t\t${Loc.getMessage('JS_UI_ACCESSRIGHTS_CREATE_ROLE')}\r\n\t\t\t\t</div>\r\n\t\t\t`;\r\n\r\n\t\t\tthis.controllerMenu = Tag.render`\r\n\t\t\t\t<div class='ui-access-rights-column-item-controller-link'>\r\n\t\t\t\t\t${Loc.getMessage('JS_UI_ACCESSRIGHTS_COPY_ROLE')}\r\n\t\t\t\t</div>\r\n\t\t\t`;\r\n\r\n\t\t\tEvent.bind(this.controllerMenu, 'click', () => {\r\n\t\t\t\tif (this.popupMenu)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.popupMenu.close();\r\n\t\t\t\t}\r\n\t\t\t\telse if (this.grid.getUserGroups().length > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.getPopupMenu(this.grid.getUserGroups()).show();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tthis.toggleControllerMenu();\r\n\r\n\t\t\tthis.controller = Tag.render`\r\n\t\t\t\t<div class='ui-access-rights-column-item-controller'>\r\n\t\t\t\t\t${this.controllerLink}\r\n\t\t\t\t\t${this.controllerMenu}\r\n\t\t\t\t</div>\r\n\t\t\t`;\r\n\r\n\t\t\tEvent.bind(this.controllerLink, 'click', () => {\r\n\t\t\t\tEventEmitter.emit('BX.KosmosAccess.AccessRights.ColumnItem:addRole', [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tid: '0',\r\n\t\t\t\t\t\ttitle: Loc.getMessage('JS_UI_ACCESSRIGHTS_ROLE_NAME'),\r\n\t\t\t\t\t\taccessRights: [],\r\n\t\t\t\t\t\tmembers: [],\r\n\t\t\t\t\t\taccessCodes: [],\r\n\t\t\t\t\t\ttype: Role.TYPE\r\n\t\t\t\t\t}\r\n\t\t\t\t]);\r\n\r\n\t\t\t\tEventEmitter.emit('BX.KosmosAccess.AccessRights.ColumnItem:update', this);\r\n\r\n\t\t\t\tthis.toggleControllerMenu();\r\n\t\t\t\tthis.grid.lock();\r\n\t\t\t});\r\n\r\n\t\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights.ColumnItem:removeRole', this.toggleControllerMenu.bind(this));\r\n\t\t}\r\n\r\n\t\treturn this.controller;\r\n\t}\r\n\r\n\tgetPopupMenu(options): Menu\r\n\t{\r\n\t\tif (!options)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst menuItems = [];\r\n\r\n\t\toptions.map(\r\n\t\t\t(data) => {\r\n\t\t\t\tmenuItems.push({\r\n\t\t\t\t\ttext: Text.encode(data.title),\r\n\t\t\t\t\tonclick: () => {\r\n\t\t\t\t\t\tconst accessRightsCopy = Object.assign([], data.accessRights);\r\n\t\t\t\t\t\tconst accessCodesCopy =  Object.assign([], data.accessCodes);\r\n\r\n\t\t\t\t\t\tEventEmitter.emit(\r\n\t\t\t\t\t\t\t'BX.KosmosAccess.AccessRights.ColumnItem:copyRole',\r\n\t\t\t\t\t\t\t[{\r\n\t\t\t\t\t\t\t\tid: '0',\r\n\t\t\t\t\t\t\t\ttitle: Loc.getMessage('JS_UI_ACCESSRIGHTS_ROLE_NAME'),\r\n\t\t\t\t\t\t\t\taccessRights: accessRightsCopy,\r\n\t\t\t\t\t\t\t\taccessCodes: accessCodesCopy,\r\n\t\t\t\t\t\t\t\ttype: Role.TYPE,\r\n\t\t\t\t\t\t\t\tmembers: data.members\r\n\t\t\t\t\t\t\t}]\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\tEventEmitter.emit('BX.KosmosAccess.AccessRights.ColumnItem:update', this);\r\n\t\t\t\t\t\tthis.popupMenu.destroy();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\treturn this.popupMenu = new Menu(\r\n\t\t\t'ui_accessrights_copy_role_list',\r\n\t\t\tthis.controllerMenu,\r\n\t\t\tmenuItems,\r\n\t\t\t{\r\n\t\t\t\tevents: {\r\n\t\t\t\t\tonPopupClose: () => {\r\n\t\t\t\t\t\tthis.popupMenu.destroy();\r\n\t\t\t\t\t\tthis.popupMenu = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\ttoggleControllerMenu()\r\n\t{\r\n\t\tif (this.grid.getUserGroups().length === 0)\r\n\t\t{\r\n\t\t\tDom.addClass(this.controllerMenu, 'ui-access-rights-column-item-controller-link--disabled');\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tDom.removeClass(this.controllerMenu, 'ui-access-rights-column-item-controller-link--disabled');\r\n\t\t}\r\n\t}\r\n}\r\n","import ColumnItemOptions from \"../columnitem\";\r\nimport {Event, Text, Tag, Dom, Loc} from 'main.core';\r\n\r\nimport {PopupMenu} from \"main.popup\";\r\nimport Changer from \"./changer\";\r\nimport {BaseEvent, EventEmitter} from \"main.core.events\";\r\n\r\ntype VariableItem = {\r\n\tid: number,\r\n\ttitle: string,\r\n}\r\n\r\nexport default class VariableSelector extends Changer\r\n{\r\n\tstatic TYPE = 'variables';\r\n\r\n\tconstructor(options: ColumnItemOptions)\r\n\t{\r\n\t\tsuper(options);\r\n\r\n\t\tthis.selectedValues = [this.currentValue];\r\n\r\n\t\tthis.variables = options.variables || [];\r\n\t}\r\n\r\n\tbindEvents()\r\n\t{\r\n\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights:reset', this.reset.bind(this));\r\n\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights:refresh', this.refresh.bind(this));\r\n\t}\r\n\r\n\trender(): HTMLElement\r\n\t{\r\n\t\tconst title = this.getSelected()?.title ?? Loc.getMessage('JS_UI_ACCESSRIGHTS_ADD');\r\n\t\tconst variablesValue = Tag.render`\r\n\t\t\t\t<div class='ui-access-rights-column-item-text-link'>\r\n\t\t\t\t\t${Text.encode(title)}\r\n\t\t\t\t</div>\r\n\t\t\t`;\r\n\r\n\t\tEvent.bind(variablesValue, 'click', this.showVariablesPopup.bind(this));\r\n\r\n\t\tDom.append(variablesValue, this.getChanger());\r\n\r\n\t\treturn this.getChanger();\r\n\t}\r\n\r\n\trefresh(): HTMLElement\r\n\t{\r\n\t\tif (this.isModify)\r\n\t\t{\r\n\t\t\tthis.currentValue = this.selectedValues[0];\r\n\t\t\tthis.reset();\r\n\t\t}\r\n\t}\r\n\r\n\treset(): HTMLElement\r\n\t{\r\n\t\tif (this.isModify)\r\n\t\t{\r\n\t\t\tthis.selectedValues = [this.currentValue];\r\n\t\t\tthis.getChanger().innerHTML = '';\r\n\t\t\tthis.adjustChanger();\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t}\r\n\r\n\tgetSelected(): VariableItem\r\n\t{\r\n\t\tconst selected = this.variables.filter(variable => this.selectedValues.includes(variable.id));\r\n\r\n\t\treturn selected[0];\r\n\t}\r\n\r\n\tshowVariablesPopup(event: Event): void\r\n\t{\r\n\t\tconst menuItems = [];\r\n\r\n\t\tthis.variables.map((data) => {\r\n\t\t\tmenuItems.push({\r\n\t\t\t\tid: data.id,\r\n\t\t\t\ttext: data.title,\r\n\t\t\t\tonclick: this.select.bind(this),\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tPopupMenu.show(\r\n\t\t\t'ui-access-rights-column-item-popup-variables',\r\n\t\t\tevent.target,\r\n\t\t\tmenuItems,\r\n\t\t\t{\r\n\t\t\t\tautoHide: true,\r\n\t\t\t\tevents : {\r\n\t\t\t\t\tonPopupClose: () => {\r\n\t\t\t\t\t\tPopupMenu.destroy('ui-access-rights-column-item-popup-variables');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\tselect(event: BaseEvent, item: MenuItem)\r\n\t{\r\n\t\tthis.selectedValues = [item.id];\r\n\r\n\t\titem\r\n\t\t\t.getMenuWindow()\r\n\t\t\t?.close()\r\n\t\t;\r\n\r\n\t\tthis.getChanger().innerHTML = '';\r\n\t\tthis.render();\r\n\t\tthis.adjustChanger();\r\n\r\n\t\tEventEmitter.emit('BX.KosmosAccess.AccessRights.ColumnItem:selectAccessItems', this);\r\n\t\tEventEmitter.emit('BX.KosmosAccess.AccessRights.ColumnItem:update', this);\r\n\t}\r\n}\r\n","import {Tag, Text} from \"main.core\";\r\nimport Title from \"./title\";\r\n\r\nexport default class UserGroupTitle extends Title\r\n{\r\n\tstatic TYPE = 'userGroupTitle';\r\n\r\n\trender(): HTMLElement\r\n\t{\r\n\t\treturn Tag.render`\r\n\t\t\t<div \r\n\t\t\t\tclass='ui-access-rights-column-item-text'\r\n\t\t\t\tdata-id='${this.getId()}'\r\n\t\t\t>\r\n\t\t\t\t${Text.encode(this.text)}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n}","import {DefaultFooter, Dialog, Item} from 'ui.entity-selector';\r\nimport {Dom, Loc, Tag, Event} from 'main.core';\r\n\r\nexport default class Footer extends DefaultFooter\r\n{\r\n\tconstructor(dialog: Dialog, options: { [option: string]: any })\r\n\t{\r\n\t\tsuper(dialog, options);\r\n\r\n\t\tthis.selectAllButton = Tag.render`<div class=\"ui-selector-footer-link ui-selector-search-footer-label--hide\">${Loc.getMessage('JS_UI_ACCESSRIGHTS_ALL_SELECT_LABEL')}</div>`;\r\n\t\tEvent.bind(this.selectAllButton, 'click', this.selectAll.bind(this));\r\n\t\tthis.deselectAllButton = Tag.render`<div class=\"ui-selector-footer-link ui-selector-search-footer-label--hide\">${Loc.getMessage('JS_UI_ACCESSRIGHTS_ALL_DESELECT_LABEL')}</div>`;\r\n\t\tEvent.bind(this.deselectAllButton, 'click', this.deselectAll.bind(this));\r\n\r\n\t\tthis.getDialog().subscribe('Item:onSelect', this.onItemStatusChange.bind(this));\r\n\t\tthis.getDialog().subscribe('Item:onDeselect', this.onItemStatusChange.bind(this));\r\n\t}\r\n\r\n\tgetContent(): HTMLElement\r\n\t{\r\n\t\tthis.toggleSelectButtons();\r\n\r\n\t\treturn Tag.render`\r\n\t\t\t<div class=\"ui-selector-search-footer-box\">\r\n\t\t\t\t${this.selectAllButton}\r\n\t\t\t\t${this.deselectAllButton}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\ttoggleSelectButtons(): void\r\n\t{\r\n\t\tif (this.getDialog().getSelectedItems().length === this.getDialog().getItems().length)\r\n\t\t{\r\n\t\t\tif (Dom.hasClass(this.deselectAllButton, 'ui-selector-search-footer-label--hide'))\r\n\t\t\t{\r\n\t\t\t\tDom.addClass(this.selectAllButton, 'ui-selector-search-footer-label--hide');\r\n\t\t\t\tDom.removeClass(this.deselectAllButton, 'ui-selector-search-footer-label--hide');\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (Dom.hasClass(this.selectAllButton, 'ui-selector-search-footer-label--hide'))\r\n\t\t{\r\n\t\t\tDom.addClass(this.deselectAllButton, 'ui-selector-search-footer-label--hide');\r\n\t\t\tDom.removeClass(this.selectAllButton, 'ui-selector-search-footer-label--hide');\r\n\t\t}\r\n\t}\r\n\r\n\tselectAll(): void\r\n\t{\r\n\t\tif (this.getDialog().getSelectedItems().length === this.getDialog().getItems().length)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis\r\n\t\t\t.getDialog()\r\n\t\t\t.getItems()\r\n\t\t\t.forEach((item: Item) => {\r\n\t\t\t\titem.select();\r\n\t\t\t})\r\n\t\t;\r\n\t}\r\n\r\n\tdeselectAll(): void\r\n\t{\r\n\t\tthis\r\n\t\t\t.getDialog()\r\n\t\t\t.getSelectedItems()\r\n\t\t\t.forEach((item: Item) => {\r\n\t\t\t\titem.deselect();\r\n\t\t\t})\r\n\t\t;\r\n\t}\r\n\r\n\tonItemStatusChange(): void\r\n\t{\r\n\t\tthis.toggleSelectButtons();\r\n\t}\r\n}","import ColumnItemOptions from \"../../columnitem\";\r\nimport {Event, Text, Tag, Dom, Type, Loc} from 'main.core';\r\nimport {Dialog, Item} from 'ui.entity-selector';\r\n\r\nimport Changer from \"../changer\";\r\nimport {EventEmitter} from \"main.core.events\";\r\nimport Footer from \"./footer\";\r\nimport 'ui.hint';\r\n\r\ntype VariableItem = {\r\n\tid: number,\r\n\ttitle: string,\r\n}\r\n\r\nexport default class MultiSelector extends Changer\r\n{\r\n\tstatic TYPE = 'multivariables';\r\n\r\n\tconstructor(options: ColumnItemOptions)\r\n\t{\r\n\t\tsuper(options);\r\n\t\tthis.variables = options.variables || [];\r\n\t\tthis.enableSearch = options.enableSearch ?? false;\r\n\t\tthis.placeholder = options.placeholder || '';\r\n\t\tthis.hintTitle = options.hintTitle || '';\r\n\t\tthis.allSelectedCode = Text.toNumber(options.allSelectedCode || -1);\r\n\t\tthis.showAvatars = options.showAvatars ?? true;\r\n\t\tthis.compactView = options.compactView ?? false;\r\n\t\tthis.currentValue = Type.isArray(options.currentValue) ? options.currentValue : [];\r\n\t\tthis.currentValue = this.currentValue.map(value => Text.toNumber(value));\r\n\t\tthis.selectedValues = this.currentValue;\r\n\r\n\t\tthis.variables = this.variables.map((item) => {\r\n\t\t\titem.entityId = item.entityId || 'editor-right-item';\r\n\t\t\titem.tabs = 'recents';\r\n\t\t\treturn item;\r\n\t\t});\r\n\r\n\t\tthis.selector = this.createSelector();\r\n\t}\r\n\r\n\tbindEvents()\r\n\t{\r\n\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights:reset', this.reset.bind(this));\r\n\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights:refresh', this.refresh.bind(this));\r\n\t}\r\n\r\n\tcreateSelector(): Dialog\r\n\t{\r\n\t\treturn new Dialog({\r\n\t\t\theight: 300,\r\n\t\t\tid: this.getId(),\r\n\t\t\tcontext: 'editor-right-items',\r\n\t\t\tenableSearch: this.enableSearch,\r\n\t\t\tmultiple: true,\r\n\t\t\tdropdownMode: true,\r\n\t\t\tcompactView: this.compactView,\r\n\t\t\tshowAvatars: this.showAvatars,\r\n\t\t\tselectedItems: this.getSelected(),\r\n\t\t\tsearchOptions: {\r\n\t\t\t\tallowCreateItem: false\r\n\t\t\t},\r\n\t\t\tevents: {\r\n\t\t\t\t'Item:onSelect': this.setSelectedInputs.bind(this),\r\n\t\t\t\t'Item:onDeselect': this.setSelectedInputs.bind(this),\r\n\t\t\t},\r\n\t\t\tentities: [\r\n\t\t\t\t{\r\n\t\t\t\t\tid: 'editor-right-item',\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\titems: this.variables,\r\n\t\t\tfooter: Footer,\r\n\t\t});\r\n\t}\r\n\r\n\trender(): HTMLElement\r\n\t{\r\n\t\tlet title = '';\r\n\t\tif (this.includesSelected(this.allSelectedCode))\r\n\t\t{\r\n\t\t\ttitle = Loc.getMessage('JS_UI_ACCESSRIGHTS_ALL_ACCEPTED');\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tconst titles = [];\r\n\t\t\tthis.getSelected()?.forEach((item) => {\r\n\t\t\t\ttitles.push(item.title)\r\n\t\t\t});\r\n\r\n\t\t\tif (titles.length > 0 )\r\n\t\t\t{\r\n\t\t\t\tconst firstItem = titles[0];\r\n\t\t\t\ttitle =\r\n\t\t\t\t\ttitles.length - 1 > 0\r\n\t\t\t\t\t\t? Loc.getMessage(\r\n\t\t\t\t\t\t\t'JS_UI_ACCESSRIGHTS_HAS_SELECTED_ITEMS',\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t'#FIRST_ITEM_NAME#':\r\n\t\t\t\t\t\t\t\t\tfirstItem.length > 10\r\n\t\t\t\t\t\t\t\t\t\t? firstItem.slice(0, 10) + '...'\r\n\t\t\t\t\t\t\t\t\t\t: firstItem\r\n\t\t\t\t\t\t\t\t,\r\n\t\t\t\t\t\t\t\t'#COUNT_REST_ITEMS#': titles.length - 1,\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t: firstItem\r\n\t\t\t\t;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\ttitle = Loc.getMessage('JS_UI_ACCESSRIGHTS_ADD');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet hint = '';\r\n\t\tif (this.selector.getSelectedItems().length > 0)\r\n\t\t{\r\n\t\t\tconst hintTitle =\r\n\t\t\t\tType.isStringFilled(this.hintTitle)\r\n\t\t\t\t\t? this.hintTitle\r\n\t\t\t\t\t: Loc.getMessage('JS_UI_ACCESSRIGHTS_SELECTED_ITEMS_TITLE')\r\n\t\t\t;\r\n\t\t\thint += '<p>' + hintTitle + ':</p>';\r\n\t\t\thint += '<ul>';\r\n\t\t\tthis.selector.getSelectedItems().forEach((item: Item) => hint += '<li>' + Text.encode(item.getTitle()))\r\n\t\t\thint += '</ul>';\r\n\t\t}\r\n\r\n\t\tconst variablesValue = Tag.render`\r\n\t\t\t\t<div class='ui-access-rights-column-item-text-link' data-hint-html data-hint-no-icon data-hint=\"${Text.encode(hint)}\">\r\n\t\t\t\t\t${Text.encode(title)}\r\n\t\t\t\t</div>\r\n\t\t\t`;\r\n\r\n\t\tEvent.bind(variablesValue, 'click', this.showSelector.bind(this));\r\n\r\n\t\tDom.append(variablesValue, this.getChanger());\r\n\r\n\t\tBX.UI.Hint.init(this.getChanger());\r\n\t\treturn this.getChanger();\r\n\t}\r\n\r\n\trefresh(): HTMLElement\r\n\t{\r\n\t\tif (this.isModify)\r\n\t\t{\r\n\t\t\tthis.currentValue = this.selectedValues;\r\n\t\t\tthis.reset();\r\n\t\t}\r\n\t}\r\n\r\n\treset(): HTMLElement\r\n\t{\r\n\t\tif (this.isModify)\r\n\t\t{\r\n\t\t\tthis.selectedValues = this.currentValue;\r\n\t\t\tthis.selector = this.createSelector();\r\n\t\t\tthis.getChanger().innerHTML = '';\r\n\t\t\tthis.adjustChanger();\r\n\t\t\tthis.render();\r\n\t\t}\r\n\t}\r\n\r\n\tgetSelected(): ?VariableItem[]\r\n\t{\r\n\t\tif (this.includesSelected(this.allSelectedCode))\r\n\t\t{\r\n\t\t\treturn this.variables;\r\n\t\t}\r\n\r\n\t\treturn this.variables.filter(variable => this.includesSelected(variable.id));\r\n\t}\r\n\r\n\tincludesSelected(item): boolean\r\n\t{\r\n\t\treturn this.selectedValues.includes(Text.toNumber(item));\r\n\t}\r\n\r\n\tshowSelector(event: Event): void\r\n\t{\r\n\t\tthis.selector.show();\r\n\t}\r\n\r\n\tsetSelectedInputs(): void\r\n\t{\r\n\t\tconst selected = this.selector.getSelectedItems();\r\n\t\tthis.selectedValues = [];\r\n\t\tif (selected.length === this.variables.length)\r\n\t\t{\r\n\t\t\tthis.selectedValues.push(this.allSelectedCode);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tselected.forEach((item) => {\r\n\t\t\t\tthis.selectedValues.push(Text.toNumber(item.id));\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis.getChanger().innerHTML = '';\r\n\t\tif (!this.isModify)\r\n\t\t{\r\n\t\t\tthis.adjustChanger();\r\n\t\t}\r\n\r\n\t\tthis.render();\r\n\r\n\t\tEventEmitter.emit('BX.KosmosAccess.AccessRights.ColumnItem:update', this);\r\n\t\tEventEmitter.emit('BX.KosmosAccess.AccessRights.ColumnItem:selectAccessItems', this);\r\n\t}\r\n}\r\n","import Column from \"./column\";\r\nimport Grid from \"./grid\";\r\nimport {Dom, Reflection, Tag} from 'main.core';\r\nimport Title from './item/title';\r\nimport Hint from './item/hint';\r\nimport Member from './item/member';\r\nimport Role from './item/role';\r\nimport Toggler from './item/toggler';\r\nimport Controller from './item/controller';\r\nimport VariableSelector from './item/variableselector';\r\nimport UserGroupTitle from './item/usergrouptitle';\r\nimport MultiSelector from \"./item/multivariable/multiselector\";\r\n\r\ntype ColumnItemOptions = {\r\n\tgrid: Grid;\r\n\tid: number;\r\n\ttype: string;\r\n\ttext: string;\r\n\tplaceholder: string;\r\n\thintTitle: string;\r\n\thint: string;\r\n\tvariables: [];\r\n\tenableSearch: boolean;\r\n\tshowAvatars: boolean;\r\n\tcompactView: boolean;\r\n\tuserGroup: null;\r\n\taccess: null;\r\n\tcurrentValue: null;\r\n\tcontroller: null;\r\n\topenPopupEvent: null;\r\n\tpopupContainer: null;\r\n\taccessCodes: null;\r\n\tallSelectedCode: number;\r\n\tcontainer: HTMLElement;\r\n\tcolumn: Column;\r\n};\r\n\r\nexport default class ColumnItem {\r\n\tconstructor(options: ColumnItemOptions)\r\n\t{\r\n\t\tthis.options = options;\r\n\t\tthis.type = options.type ? options.type : null;\r\n\t\tthis.hint = options.hint ? options.hint : null;\r\n\t\tthis.controller = options.controller ? options.controller : null;\r\n\t\tthis.column = options.column;\r\n\t}\r\n\r\n\trender(): HTMLElement\r\n\t{\r\n\t\tlet item = null;\r\n\t\tconst container = Tag.render`<div class='ui-access-rights-column-item'></div>`;\r\n\t\tthis.options.container = container;\r\n\t\tif (this.type === Role.TYPE)\r\n\t\t{\r\n\t\t\titem = new Role(this.options);\r\n\t\t\tif (this.column.newColumn)\r\n\t\t\t{\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\titem.onRoleEditMode();\r\n\t\t\t\t\titem.roleInput.value = '';\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (this.type === Member.TYPE)\r\n\t\t{\r\n\t\t\titem = new Member(this.options);\r\n\t\t}\r\n\t\telse if (this.type === Title.TYPE)\r\n\t\t{\r\n\t\t\titem = new Title(this.options);\r\n\t\t}\r\n\t\telse if (this.type === VariableSelector.TYPE)\r\n\t\t{\r\n\t\t\titem = new VariableSelector(this.options);\r\n\t\t}\r\n\t\telse if (this.type === MultiSelector.TYPE)\r\n\t\t{\r\n\t\t\titem = new MultiSelector(this.options);\r\n\t\t}\r\n\t\telse if (this.type === Toggler.TYPE)\r\n\t\t{\r\n\t\t\titem = new Toggler(this.options);\r\n\t\t}\r\n\r\n\t\tif (item)\r\n\t\t{\r\n\t\t\tDom.append(item.render(), container);\r\n\t\t}\r\n\r\n\t\tif (this.hint)\r\n\t\t{\r\n\t\t\tconst hintOptions = {\r\n\t\t\t\tclassName: 'ui-access-rights-column-item-notify',\r\n\t\t\t\t...this.options\r\n\t\t\t};\r\n\t\t\tDom.append((new Hint(hintOptions)).render(), container);\r\n\t\t}\r\n\r\n\t\tif (this.type === UserGroupTitle.TYPE)\r\n\t\t{\r\n\t\t\tDom.append((new UserGroupTitle(this.options)).render(), container);\r\n\t\t}\r\n\r\n\t\tif (this.controller)\r\n\t\t{\r\n\t\t\tDom.append((new Controller(this.options)).render(), container);\r\n\t\t}\r\n\r\n\t\treturn container;\r\n\t}\r\n}\r\n\r\nconst namespace = Reflection.namespace('BX.KosmosAccess.AccessRights');\r\nnamespace.ColumnItem = ColumnItem;\r\n","import {EventEmitter} from \"main.core.events\";\r\nimport {Dom, Event, Reflection, Tag} from 'main.core';\r\n\r\nimport Section from \"./section\";\r\nimport ColumnItem from \"./columnitem\";\r\nimport Role from \"./item/role\";\r\nimport Member from \"./item/member\";\r\nimport Title from \"./item/title\";\r\nimport UserGroupTitle from \"./item/usergrouptitle\";\r\nimport Toggler from \"./item/toggler\";\r\nimport VariableSelector from \"./item/variableselector\";\r\nimport MultiSelector from \"./item/multivariable/multiselector\";\r\n\r\ntype ColumnOptions = {\r\n\tgrid: Grid;\r\n\titems: [];\r\n\tuserGroup: [];\r\n\taccessCodes: [];\r\n\tsection: Section;\r\n\theadSection: Section;\r\n\tnewColumn: Column;\r\n\topenPopupEvent: string;\r\n\tpopupContainer: HTMLElement;\r\n};\r\n\r\nexport default class Column {\r\n\tconstructor(options: ColumnOptions)\r\n\t{\r\n\t\tthis.layout = {\r\n\t\t\tcontainer: null\r\n\t\t};\r\n\t\tthis.grid = options.grid ? options.grid : null;\r\n\t\tthis.items = options.items ? options.items : [];\r\n\t\tthis.userGroup = options.userGroup ? options.userGroup : null;\r\n\t\tthis.accessCodes = options.accessCodes ? options.accessCodes : null;\r\n\t\tthis.section = options.section ? options.section : null;\r\n\t\tthis.headSection = options.headSection;\r\n\t\tthis.newColumn = options.newColumn ? options.newColumn : null;\r\n\t\tthis.openPopupEvent = options.grid.openPopupEvent ? options.grid.openPopupEvent : null;\r\n\t\tthis.popupContainer = options.grid.popupContainer ? options.grid.popupContainer : null;\r\n\t}\r\n\r\n\tgetItem(options): ColumnItem\r\n\t{\r\n\t\toptions = options || {};\r\n\r\n\t\tlet param = {};\r\n\r\n\t\tif (options.type === UserGroupTitle.TYPE)\r\n\t\t{\r\n\t\t\tparam = {\r\n\t\t\t\ttype: options.type,\r\n\t\t\t\ttext: options.title,\r\n\t\t\t\tcontroller: options.controller\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (options.type === Title.TYPE)\r\n\t\t{\r\n\t\t\tparam = {\r\n\t\t\t\tid: options.id,\r\n\t\t\t\ttype: options.type,\r\n\t\t\t\thint: options.hint,\r\n\t\t\t\ttext: options.title,\r\n\t\t\t\tcontroller: options.controller\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (options.type === Toggler.TYPE)\r\n\t\t{\r\n\t\t\tparam = {\r\n\t\t\t\ttype: options.type,\r\n\t\t\t\taccess: options.access\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (options.type === VariableSelector.TYPE || options.type === MultiSelector.TYPE)\r\n\t\t{\r\n\t\t\tparam = {\r\n\t\t\t\ttype: options.type,\r\n\t\t\t\ttext: options.title,\r\n\t\t\t\tvariables: options.variables,\r\n\t\t\t\taccess: options.access\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (options.type === MultiSelector.TYPE)\r\n\t\t{\r\n\t\t\tparam.allSelectedCode = options.allSelectedCode;\r\n\t\t\tparam.enableSearch = options.enableSearch;\r\n\t\t\tparam.showAvatars = options.showAvatars;\r\n\t\t\tparam.compactView = options.compactView;\r\n\t\t\tparam.hintTitle = options.hintTitle;\r\n\t\t}\r\n\r\n\t\tif (options.type === Role.TYPE)\r\n\t\t{\r\n\t\t\tparam = {\r\n\t\t\t\ttype: options.type,\r\n\t\t\t\ttext: options.title\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (options.type === Member.TYPE)\r\n\t\t{\r\n\t\t\tconst accessCodes = [];\r\n\r\n\t\t\tfor (const item in options.members)\r\n\t\t\t{\r\n\t\t\t\taccessCodes[item] = options.members[item].type;\r\n\t\t\t}\r\n\r\n\t\t\tparam = {\r\n\t\t\t\ttype: options.type,\r\n\t\t\t\taccessCodes: accessCodes\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tparam.column = this;\r\n\t\tparam.userGroup = this.userGroup;\r\n\t\tparam.openPopupEvent = this.openPopupEvent;\r\n\t\tparam.popupContainer = this.popupContainer;\r\n\t\tparam.currentValue = null;\r\n\r\n\t\tparam.grid = this.grid;\r\n\r\n\t\tif (\r\n\t\t\toptions.type === VariableSelector.TYPE\r\n\t\t\t|| options.type === MultiSelector.TYPE\r\n\t\t\t|| options.type === Toggler.TYPE\r\n\t\t)\r\n\t\t{\r\n\t\t\tconst accessId = param.access.id.toString();\r\n\t\t\tconst accessRights = param.userGroup?.accessRights ?? [];\r\n\r\n\t\t\tfor (let i = 0; i < accessRights.length; i++)\r\n\t\t\t{\r\n\t\t\t\tif (accessId === accessRights[i].id.toString())\r\n\t\t\t\t{\r\n\t\t\t\t\tif (options.type === MultiSelector.TYPE)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tparam.currentValue = param.currentValue ?? [];\r\n\t\t\t\t\t\tparam.currentValue.push(accessRights[i].value);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tparam.currentValue = accessRights[i].value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn new ColumnItem(param);\r\n\t}\r\n\r\n\tgetUserGroup(): []\r\n\t{\r\n\t\treturn this.userGroup;\r\n\t}\r\n\r\n\tremove(): void\r\n\t{\r\n\t\tif (Dom.hasClass(this.layout.container, 'ui-access-rights-column-new'))\r\n\t\t{\r\n\t\t\tthis.resetClassNew();\r\n\t\t}\r\n\r\n\t\tDom.addClass(this.layout.container,'ui-access-rights-column-remove')\r\n\t\tDom.style(this.layout.container, 'width', this.layout.container.offsetWidth + 'px')\r\n\r\n\t\tEvent.bind(this.layout.container, 'animationend', () => {\r\n\t\t\tDom.style(this.layout.container, 'minWidth', '0px')\r\n\t\t\tDom.style(this.layout.container, 'maxWidth', '0px')\r\n\t\t});\r\n\r\n\r\n\t\tsetTimeout(() => {\r\n\t\t\tDom.remove(this.layout.container);\r\n\t\t}, 500);\r\n\t}\r\n\r\n\tresetClassNew(): void\r\n\t{\r\n\t\tDom.removeClass(this.layout.container,'ui-access-rights-column-new');\r\n\t}\r\n\r\n\trender(): HTMLElement\r\n\t{\r\n\t\tif (!this.layout.container)\r\n\t\t{\r\n\t\t\tconst itemsFragment = document.createDocumentFragment();\r\n\r\n\t\t\tif (this.headSection)\r\n\t\t\t{\r\n\t\t\t\tthis.userGroup.type = Role.TYPE;\r\n\t\t\t\tDom.append(this.getItem(this.userGroup).render(), itemsFragment);\r\n\r\n\t\t\t\tthis.userGroup.type = Member.TYPE;\r\n\t\t\t\tDom.append(this.getItem(this.userGroup).render(), itemsFragment);\r\n\t\t\t}\r\n\r\n\t\t\tthis.items.map(\r\n\t\t\t\t(data) => {\r\n\t\t\t\t\tconst item = this.getItem(data);\r\n\t\t\t\t\tDom.append(item.render(), itemsFragment);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t\tthis.layout.container = Tag.render`<div class='ui-access-rights-column'></div>`;\r\n\t\t\tif (this.newColumn)\r\n\t\t\t{\r\n\t\t\t\tDom.addClass('ui-access-rights-column-new', this.layout.container)\r\n\t\t\t}\r\n\r\n\t\t\tEventEmitter.subscribe('BX.KosmosAccess.AccessRights:refresh', this.resetClassNew.bind(this));\r\n\r\n\t\t\tDom.append(itemsFragment, this.layout.container);\r\n\r\n\t\t\treturn this.layout.container;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst namespace = Reflection.namespace('BX.KosmosAccess.AccessRights');\r\nnamespace.Column = Column;","import {EventEmitter, BaseEvent} from \"main.core.events\";\r\nimport {PopupMenu} from 'main.popup';\r\nimport {Dom, Event, Reflection, Text, Tag, Loc} from 'main.core';\r\nimport Grid from \"./grid\";\r\nimport Column from \"./column\";\r\nimport Title from \"./item/title\";\r\nimport UserGroupTitle from \"./item/usergrouptitle\";\r\nimport VariableSelector from \"./item/variableselector\";\r\nimport MultiSelector from \"./item/multivariable/multiselector\";\r\nimport Hint from \"./item/hint\";\r\n\r\ntype SectionOptions = {\r\n\tid: string;\r\n\theadSection: Section;\r\n\ttitle: string;\r\n\thint: string;\r\n\trights: [];\r\n\tuserGroups: [];\r\n\tgrid: Grid;\r\n};\r\n\r\nexport default class Section {\r\n\tconstructor(options: SectionOptions)\r\n\t{\r\n\t\tthis.id = options.id ?? null;\r\n\t\tthis.headSection = options.headSection ? options.headSection : null;\r\n\t\tthis.title = options.title;\r\n\t\tthis.hint = options.hint;\r\n\t\tthis.rights = options.rights ? options.rights : [];\r\n\t\tthis.userGroups = options.userGroups ? options.userGroups : [];\r\n\t\tthis.grid = options.grid ? options.grid : null;\r\n\r\n\t\tthis.layout = {\r\n\t\t\ttitle: null,\r\n\t\t\theadColumn: null,\r\n\t\t\tcolumns: null,\r\n\t\t\tcontent: null,\r\n\t\t\tearLeft: null,\r\n\t\t\tearRight: null\r\n\t\t};\r\n\r\n\t\tthis.scroll = 0;\r\n\t\tthis.earTimer = null;\r\n\t\tthis.earLeftTimer = null;\r\n\t\tthis.earRightTimer = null;\r\n\t\tthis.columns = [];\r\n\r\n\t\tthis.bindEvents();\r\n\t}\r\n\r\n\tbindEvents(): void\r\n\t{\r\n\t\tEventEmitter.subscribe(this.grid, 'AccessRights.Section:scroll', (event: BaseEvent) => {\r\n\t\t\tconst [object] = event.getData();\r\n\t\t\tif (this.title !== object.title)\r\n\t\t\t{\r\n\t\t\t\tthis.getColumnsContainer().scrollLeft = object.getScroll()\r\n\t\t\t}\r\n\t\t\tobject.adjustEars();\r\n\t\t\tPopupMenu.destroy('ui-access-rights-column-item-popup-variables');\r\n\t\t});\r\n\r\n\t\tEvent.bind(window, 'resize', this.adjustEars.bind(this));\r\n\t}\r\n\r\n\tgetGrid(): Grid\r\n\t{\r\n\t\treturn this.grid;\r\n\t}\r\n\r\n\taddColumn(param): void\r\n\t{\r\n\t\tif(!param)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst options = Object.assign({}, param);\r\n\t\toptions.userGroup = param;\r\n\t\tconst column = this.getColumn(options);\r\n\r\n\t\tDom.append(column.render(), this.layout.columns)\r\n\t\tthis.columns.push(column);\r\n\t}\r\n\r\n\tgetColumn(options): Column\r\n\t{\r\n\t\tconst controls = [];\r\n\r\n\t\tthis.rights.map(\r\n\t\t\t(data) => {\r\n\t\t\t\tconst isVariable = (data.type === VariableSelector.TYPE || data.type === MultiSelector.TYPE);\r\n\r\n\t\t\t\tcontrols.push({\r\n\t\t\t\t\ttype: data.type,\r\n\t\t\t\t\ttitle: isVariable ? data.title : null,\r\n\t\t\t\t\thint: data.hint,\r\n\t\t\t\t\tvariables: isVariable ? data.variables : [],\r\n\t\t\t\t\tenableSearch: isVariable ? data.enableSearch : null,\r\n\t\t\t\t\tshowAvatars: isVariable ? data.showAvatars : false,\r\n\t\t\t\t\tcompactView: isVariable ? data.compactView : false,\r\n\t\t\t\t\thintTitle: isVariable ? data.hintTitle : null,\r\n\t\t\t\t\tallSelectedCode: isVariable ? data.allSelectedCode : null,\r\n\t\t\t\t\taccess: data\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\treturn new Column({\r\n\t\t\titems: controls,\r\n\t\t\tuserGroup: options.userGroup ? options.userGroup : null,\r\n\t\t\tsection: this,\r\n\t\t\theadSection: options.headSection,\r\n\t\t\tgrid: this.grid,\r\n\t\t\tnewColumn: options.newColumn ? options.newColumn : null\r\n\t\t});\r\n\t}\r\n\r\n\tremoveColumn(param): void\r\n\t{\r\n\t\tif (!param)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < this.columns.length; i++)\r\n\t\t{\r\n\t\t\tif (param.userGroup === this.columns[i].userGroup)\r\n\t\t\t{\r\n\t\t\t\tthis.columns[i].remove();\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\taddHeadColumn(): Column\r\n\t{\r\n\t\tlet titles = [];\r\n\r\n\t\tif(!this.headSection)\r\n\t\t{\r\n\t\t\tthis.rights.map((data) => {\r\n\t\t\t\ttitles.push({\r\n\t\t\t\t\tid: data.id,\r\n\t\t\t\t\ttype: Title.TYPE,\r\n\t\t\t\t\ttitle: data.title,\r\n\t\t\t\t\thint: data.hint\r\n\t\t\t\t})\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (this.headSection)\r\n\t\t{\r\n\t\t\ttitles = [\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: UserGroupTitle.TYPE,\r\n\t\t\t\t\ttitle: Loc.getMessage('JS_UI_ACCESSRIGHTS_ROLES'),\r\n\t\t\t\t\tcontroller: true\r\n\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: UserGroupTitle.TYPE,\r\n\t\t\t\t\ttitle: Loc.getMessage('JS_UI_ACCESSRIGHTS_EMPLOYEES_AND_DEPARTMENTS'),\r\n\t\t\t\t\tcontroller: false\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\r\n\t\tconst column = new Column({\r\n\t\t\titems: titles,\r\n\t\t\tsection: this,\r\n\t\t\tgrid: this.grid\r\n\t\t});\r\n\r\n\t\tDom.append(column.render(), this.layout.headColumn);\r\n\r\n\t\treturn column;\r\n\t}\r\n\r\n\tgetColumnsContainer(): HTMLElement\r\n\t{\r\n\t\tif (!this.layout.columns)\r\n\t\t{\r\n\t\t\tconst column = Tag.render`<div class='ui-access-rights-section-wrapper'></div>`;\r\n\t\t\tEvent.bind(column, 'scroll', this.adjustScroll.bind(this));\r\n\t\t\tthis.layout.columns = column;\r\n\t\t}\r\n\r\n\t\treturn this.layout.columns;\r\n\t}\r\n\r\n\tgetTitleNode(): HTMLElement\r\n\t{\r\n\t\tconst node = Tag.render`<div class='ui-access-rights-section-title'>${Text.encode(this.title)}</div>`;\r\n\r\n\t\tif (this.hint)\r\n\t\t{\r\n\t\t\tconst hintNode = new Hint({\r\n\t\t\t\thint: this.hint,\r\n\t\t\t\tclassName: 'ui-access-rights-section-title-hint'\r\n\t\t\t});\r\n\t\t\tnode.appendChild(hintNode.render());\r\n\t\t}\r\n\r\n\t\treturn node;\r\n\t}\r\n\r\n\tadjustScroll(): void\r\n\t{\r\n\t\tif (Text.toNumber(this.scroll) !== Text.toNumber(this.getColumnsContainer().scrollLeft))\r\n\t\t{\r\n\t\t\tthis.scroll = this.getColumnsContainer().scrollLeft;\r\n\t\t\tEventEmitter.emit(this.grid, \"AccessRights.Section:scroll\", [this]);\r\n\t\t}\r\n\t}\r\n\r\n\tadjustEars(): void\r\n\t{\r\n\t\tconst container = this.getColumnsContainer();\r\n\t\tconst scroll = container.scrollLeft;\r\n\r\n\t\tconst isLeftVisible = scroll > 0;\r\n\t\tconst isRightVisible = container.scrollWidth > (Math.round(scroll + container.offsetWidth));\r\n\r\n\t\tthis.getContentContainer().classList[isLeftVisible ? 'add' : 'remove']('ui-access-rights-section-ear-left-shown');\r\n\t\tthis.getContentContainer().classList[isRightVisible ? 'add' : 'remove']('ui-access-rights-section-ear-right-shown');\r\n\t}\r\n\r\n\tgetContentContainer(): HTMLElement\r\n\t{\r\n\t\tif (!this.layout.content)\r\n\t\t{\r\n\t\t\tthis.layout.content = Tag.render`\r\n\t\t\t\t<div class='ui-access-rights-section-content'>\r\n\t\t\t\t\t${this.getColumnsContainer()}\r\n\t\t\t\t\t${this.getEarLeft()}\r\n\t\t\t\t\t${this.getEarRight()}\r\n\t\t\t\t</div>\r\n\t\t\t`;\r\n\t\t}\r\n\r\n\t\treturn this.layout.content;\r\n\t}\r\n\r\n\tgetEarLeft(): HTMLElement\r\n\t{\r\n\t\tif (!this.layout.earLeft)\r\n\t\t{\r\n\t\t\tthis.layout.earLeft = Tag.render`<div class='ui-access-rights-section-ear-left'></div>`;\r\n\t\t\tEvent.bind(this.layout.earLeft, 'mouseenter', () => {\r\n\t\t\t\tthis.stopAutoScroll();\r\n\t\t\t\tthis.earLeftTimer =\tsetTimeout(\r\n\t\t\t\t\t() => {\r\n\t\t\t\t\t\tthis.scrollToLeft()\r\n\t\t\t\t\t},\r\n\t\t\t\t\t110\r\n\t\t\t\t);\r\n\t\t\t});\r\n\r\n\t\t\tEvent.bind(this.layout.earLeft, 'mouseleave', () => {\r\n\t\t\t\tclearTimeout(this.earLeftTimer);\r\n\t\t\t\tthis.stopAutoScroll()\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn this.layout.earLeft;\r\n\t}\r\n\r\n\tgetEarRight(): HTMLElement\r\n\t{\r\n\t\tif (!this.layout.earRight)\r\n\t\t{\r\n\t\t\tthis.layout.earRight = Tag.render`<div class='ui-access-rights-section-ear-right'></div>`;\r\n\t\t\tEvent.bind(this.layout.earRight, 'mouseenter', () => {\r\n\t\t\t\tthis.stopAutoScroll();\r\n\t\t\t\tthis.earRightTimer = setTimeout(\r\n\t\t\t\t\t() => {\r\n\t\t\t\t\t\tthis.scrollToRight()\r\n\t\t\t\t\t},\r\n\t\t\t\t\t110\r\n\t\t\t\t);\r\n\t\t\t});\r\n\r\n\t\t\tEvent.bind(this.layout.earRight, 'mouseleave', () => {\r\n\t\t\t\tclearTimeout(this.earRightTimer);\r\n\t\t\t\tthis.stopAutoScroll()\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn this.layout.earRight;\r\n\t}\r\n\r\n\tscrollToRight(param: number, stop): void\r\n\t{\r\n\t\tconst interval = param ? 2 : 20;\r\n\r\n\t\tthis.earTimer = setInterval(\r\n\t\t\t() => {\r\n\t\t\t\tthis.getColumnsContainer().scrollLeft += 10;\r\n\t\t\t\tif(param && param <= this.getColumnsContainer().scrollLeft)\r\n\t\t\t\t{\r\n\t\t\t\t\t this.stopAutoScroll();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tinterval\r\n\t\t);\r\n\r\n\t\tif(stop === 'stop')\r\n\t\t{\r\n\t\t\tsetTimeout(\r\n\t\t\t\t() => {\r\n\t\t\t\t\tthis.stopAutoScroll();\r\n\t\t\t\t\tthis.getGrid().unlock();\r\n\t\t\t\t},\r\n\t\t\t\tparam * 2\r\n\t\t\t)\r\n\t\t}\r\n\t}\r\n\r\n\tscrollToLeft(): void\r\n\t{\r\n\t\tthis.earTimer = setInterval(\r\n\t\t\t() => {\r\n\t\t\t\tthis.getColumnsContainer().scrollLeft -= 10;\r\n\t\t\t},\r\n\t\t\t20\r\n\t\t)\r\n\t}\r\n\r\n\tstopAutoScroll(): void\r\n\t{\r\n\t\tclearInterval(this.earTimer);\r\n\t}\r\n\r\n\tgetScroll(): number\r\n\t{\r\n\t\treturn this.scroll;\r\n\t}\r\n\r\n\trender(): HTMLElement\r\n\t{\r\n\t\tconst title = this.title ? this.getTitleNode() : null;\r\n\r\n\t\tconst sectionContainer = Tag.render`\r\n\t\t\t<div class='ui-access-rights-section'>\r\n\t\t\t\t${title}\r\n\t\t\t\t${this.getMainContainer()}\r\n\t\t\t</div>\r\n\t\t`;\r\n\r\n\t\tif (this.headSection)\r\n\t\t{\r\n\t\t\tDom.addClass(sectionContainer, 'ui-access-rights--head-section')\r\n\t\t}\r\n\r\n\t\tthis.addHeadColumn();\r\n\r\n\t\tconst columnsFragment = document.createDocumentFragment();\r\n\r\n\t\tconst userGroups = this.grid.getUserGroups() ?? [];\r\n\t\tfor (let i = 0; i < userGroups.length; i++)\r\n\t\t{\r\n\t\t\tconst column = this.getColumn(\r\n\t\t\t\t{\r\n\t\t\t\t\theadSection: this.headSection ? this.headSection : null,\r\n\t\t\t\t\tuserGroup: userGroups[i]\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t\tthis.columns.push(column);\r\n\t\t\tDom.append(column.render(), columnsFragment);\r\n\t\t}\r\n\r\n\t\tDom.append(columnsFragment, this.getColumnsContainer());\r\n\r\n\t\treturn sectionContainer;\r\n\t}\r\n\r\n\tgetMainContainer(): HTMLElement\r\n\t{\r\n\t\tthis.layout.headColumn = Tag.render`<div class='ui-access-rights-section-head'></div>`;\r\n\t\treturn Tag.render`\r\n\t\t\t<div class='ui-access-rights-section-container'>\r\n\t\t\t\t${this.layout.headColumn}\r\n\t\t\t\t${this.getContentContainer()}\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n}\r\n\r\nconst namespace = Reflection.namespace('BX.KosmosAccess.AccessRights');\r\nnamespace.Section = Section;\r\n"],"names":["BX","Reflection","namespace","Grid","options","renderTo","buttonPanel","UI","ButtonPanel","layout","container","component","actionSave","ACTION_SAVE","actionDelete","ACTION_DELETE","actionLoad","ACTION_LOAD","mode","MODE","openPopupEvent","popupContainer","additionalSaveParams","signedParameters","loadParams","loader","timer","initData","userGroups","accessRights","isRequested","loadData","bindEvents","EventEmitter","subscribe","updateRole","bind","updateAccessVariationRight","updateAccessRight","adjustButtonPanel","addUserGroup","addRoleColumn","removeRoleColumn","onGetEntityTypes","accessRightsSections","headSection","members","columns","emit","title","Notification","Center","notify","content","position","autoHideDelay","setTimeout","blockGrid","needReload","dataToSave","i","length","Text","toNumber","id","push","accessCodes","type","ajax","runComponentAction","data","parameters","then","reloadGrid","showNotification","Loc","getMessage","unBlockGrid","fireEventRefresh","clearTimeout","waitContainer","getContainer","querySelector","Dom","removeClass","addClass","getMainContainer","roleId","response","ACCESS_RIGHTS","USER_GROUPS","draw","offsetTop","getBoundingClientRect","top","style","getLoader","show","hide","Loader","target","param","removeColumn","map","targetIndex","indexOf","userGroup","splice","deleteActionRequest","event","getData","sections","newColumn","addColumn","scrollToRight","getColumnsContainer","scrollWidth","offsetWidth","item","index","text","modifiedItems","querySelectorAll","modifiedRoles","modifiedUsers","modifiedVariables","accessId","access","value","switcher","isChecked","deleteIds","forEach","values","selectedValues","addSection","user","Section","grid","hint","sectionHint","sectionTitle","rights","Tag","render","docFragmentSections","document","createDocumentFragment","append","getHeadSection","getSections","innerHTML","afterRender","adjustEars","params","option","buildOption","state","controls","Main","selectorManagerV2","selectorInstance","Object","keys","entityTypes","USERGROUPS","enableSearch","searchById","addTab","returnItemUrl","getOption","dataColumnAttribute","node","bindOptions","hasAttribute","Type","isUndefined","columnId","getAttribute","accessItem","entityType","accessCodesResult","AccessRights","Base","currentValue","identificator","Math","random","parentContainer","Title","getId","encode","Event","adjustPopupHelper","popupHelper","close","set","cloneNode","body","remove","getPopupHelper","PopupWindowManager","create","autoHide","darkMode","maxWidth","offsetLeft","animation","Hint","className","hintNode","hintManager","createInstance","popupParameters","angle","setAttribute","attributeName","attributeHtmlName","attributeInteractivityName","initNode","Member","addToAccessCodes","removeFromAccessCodes","resetNewMembers","member","membersFragment","counter","validateVariables","reverse","userNode","avatar","userAvatar","name","encodeURI","avatarClass","emptyAvatar","getAddUserToRole","adjustPopupUserControl","getMember","newMembers","getButtonPanel","firstKey","toUpperCase","entityId","url","toLowerCase","updateMembers","key","users","groups","departments","sonetgroups","counterUsers","showUserSelectorPopup","getUserPopup","addUserToRole","popupUsers","contentTitle","onTitleClick","activate","adjustSlicker","groupTitleItem","getUserPopupTogglerGroup","footer","footerLink","preventDefault","isDomNode","slicker","titles","contents","contentPadding","padding","offset","closeEsc","events","onPopupShow","firstActiveNode","onPopupClose","destroy","array","toggler","iconClass","removeButton","itemsSelected","onCustomEvent","bindNode","selectorId","selectedItems","Role","column","window","getRole","closest","offRoleEditMode","role","roleInput","keyCode","roleValue","editControl","onRoleEditMode","removeControl","showPopupConfirm","roleControlWrapper","focus","popupConfirm","width","overlay","setButtons","Button","click","getUserGroup","innerText","Changer","isModify","changer","offChanger","refreshStatus","getChanger","toggleClass","Toggler","Switcher","size","checked","handlers","unchecked","toggled","adjustChanger","check","getNode","Controller","controller","controllerLink","controllerMenu","popupMenu","getUserGroups","getPopupMenu","toggleControllerMenu","TYPE","lock","menuItems","onclick","accessRightsCopy","assign","accessCodesCopy","Menu","VariableSelector","variables","reset","refresh","getSelected","variablesValue","showVariablesPopup","selected","filter","variable","includes","select","PopupMenu","getMenuWindow","UserGroupTitle","Footer","dialog","selectAllButton","selectAll","deselectAllButton","deselectAll","getDialog","onItemStatusChange","toggleSelectButtons","getSelectedItems","getItems","hasClass","deselect","DefaultFooter","MultiSelector","placeholder","hintTitle","allSelectedCode","showAvatars","compactView","isArray","tabs","selector","createSelector","Dialog","height","context","multiple","dropdownMode","searchOptions","allowCreateItem","setSelectedInputs","entities","items","includesSelected","firstItem","slice","isStringFilled","getTitle","showSelector","init","ColumnItem","hintOptions","Column","section","toString","resetClassNew","itemsFragment","getItem","headColumn","earLeft","earRight","scroll","earTimer","earLeftTimer","earRightTimer","object","scrollLeft","getScroll","getColumn","isVariable","adjustScroll","appendChild","isLeftVisible","isRightVisible","round","getContentContainer","classList","getEarLeft","getEarRight","stopAutoScroll","scrollToLeft","stop","interval","setInterval","getGrid","unlock","clearInterval","getTitleNode","sectionContainer","addHeadColumn","columnsFragment"],"mappings":"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"}